{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/debug/src/browser.js","webpack:///./node_modules/debug/src/common.js","webpack:///./node_modules/debug/src/index.js","webpack:///./node_modules/debug/src/node.js","webpack:///./node_modules/has-flag/index.js","webpack:///./node_modules/ms/index.js","webpack:///./node_modules/supports-color/index.js","webpack:///./src/browser/api/browser-action.ts","webpack:///./src/browser/api/commands.ts","webpack:///./src/browser/api/common.ts","webpack:///./src/browser/api/context-menus.ts","webpack:///./src/browser/api/cookies.ts","webpack:///./src/browser/api/notifications.ts","webpack:///./src/browser/api/runtime.ts","webpack:///./src/browser/api/tabs.ts","webpack:///./src/browser/api/web-navigation.ts","webpack:///./src/browser/api/windows.ts","webpack:///./src/browser/index.ts","webpack:///./src/browser/popup.ts","webpack:///./src/browser/router.ts","webpack:///./src/browser/store.ts","webpack:///./src/index.ts","webpack:///external \"electron\"","webpack:///external \"events\"","webpack:///external \"fs\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///external \"tty\"","webpack:///external \"util\""],"names":["debug","require","app","isReady","protocol","registerSchemesAsPrivileged","scheme","privileges","bypassCSP","getBrowserActionDefaults","extension","manifest","getExtensionManifest","browser_action","action","title","default_title","name","iconPath","getIconPath","icon","path","default_popup","popup","BrowserActionAPI","constructor","ctx","actionMap","Map","observers","Set","queuedUpdate","handleCrxRequest","request","callback","url","response","URL","hostname","requestType","tabId","searchParams","get","fragments","pathname","split","extensionId","imageSize","parseInt","resizeType","ResizeType","Up","session","getExtension","iconDetails","tabs","iconImage","iconAbsPath","resolveExtensionPath","nativeImage","createFromPath","imagePath","matchSize","imageData","createFromDataURL","undefined","statusCode","mimeType","data","toPNG","e","console","error","handle","router","apiHandler","getter","propName","details","getAction","id","result","setDetails","value","defaults","valueObj","tabAction","Object","assign","onUpdate","setter","event","handleProp","prop","key","iconModified","Date","now","preloadOpts","allowRemote","extensionContext","getState","bind","activate","sender","webContents","add","once","delete","store","on","actionDetails","setupSession","processExtension","removeActions","registerBufferProtocol","set","has","getPopupUrl","popupPath","defaultAction","actions","Array","from","entries","map","rest","tabsInfo","keys","activeTab","getActiveTabOfCurrentWindow","activeTabId","eventType","activateClick","activateContextMenu","anchorRect","toggleExtension","isDestroyed","destroy","tab","getTabById","Error","popupUrl","win","tabToWindow","PopupView","parent","emit","tabDetails","tabDetailsCache","sendEvent","menu","Menu","append","opts","MenuItem","appendSeparator","type","label","click","homePageUrl","homepage_url","createTab","contextMenuItems","buildMenuItems","length","forEach","item","optionsPage","options_page","options_ui","page","optionsPageUrl","getExtensionUrl","enabled","x","Math","floor","y","height","queueMicrotask","size","observer","send","CommandsAPI","getAll","uri","href","resPath","startsWith","validateExtensionResource","fs","stat","imageSet","match","first","pop","iconSize","icons","default_icon","getIconImage","iconAbsolutePath","escapePattern","pattern","replace","matchesPattern","regexp","RegExp","join","DEFAULT_CONTEXTS","getContextTypesFromParams","params","contexts","mediaType","pageURL","linkURL","frameURL","selectionText","isEditable","formatTitle","includes","matchesConditions","props","conditions","visible","contextTypes","targetUrl","documentUrl","inContext","some","context","targetUrlPatterns","documentUrlPatterns","ContextMenusAPI","menus","buildMenuItem","showIcon","resize","width","menuItemOptions","onClicked","buildMenuItemsFromTemplate","menuItemTemplates","itemMap","menuItem","parentId","parentMenuItem","submenu","push","menuItems","buildFromTemplate","isArray","create","createProperties","addContextItem","remove","menuItemId","items","removeAll","buildMenuItemsForExtension","contextItems","buildMenuItemsForParams","srcURL","propItems","menuType","extensionItems","checked","frameId","frameUrl","editable","wasChecked","pageUrl","linkUrl","parentMenuItemId","srcUrl","CookieStoreID","onChangedCauseTranslation","createCookieDetails","cookie","domain","hostOnly","Boolean","httpOnly","secure","storeId","Default","CookiesAPI","cookies","onChanged","cause","removed","changeInfo","broadcastEvent","getAllCookieStores","addListener","tabIds","filter","TemplateType","getBody","Basic","List","message","getUrgency","priority","createScopedIdentifier","stripScopeFromIdentifier","index","indexOf","substr","NotificationsAPI","registry","clear","notificationId","close","arg1","arg2","iconUrl","notification","Notification","subtitle","body","silent","urgency","timeoutType","requireInteraction","byUser","show","getPermissionLevel","isSupported","update","RuntimeAPI","EventEmitter","openOptionsPage","active","TabsAPI","getAllInWindow","getCurrent","insertCSS","query","reload","goForward","goBack","observeTab","updateEvents","updateHandler","onUpdated","eventName","faviconHandler","favicons","favicon","off","removeTab","onRemoved","onCreated","onActivated","getType","getURL","createTabDetails","getActiveTabFromWebContents","getSize","audible","isCurrentlyAudible","autoDiscardable","discarded","favIconUrl","highlighted","incognito","mutedInfo","muted","audioMuted","pinned","selected","status","isLoading","getTitle","windowId","impl","assignTabDetails","getTabDetails","TAB_ID_NONE","WINDOW_ID_CURRENT","lastFocusedWindowId","browserWindow","code","info","isSet","filteredTabs","reloadProperties","bypassCache","reloadIgnoringCache","updateProperties","loadURL","setAudioMuted","ids","prevDetails","compareProps","didUpdate","WindowsAPI","WINDOW_ID_NONE","BrowserWindow","getAllWindows","find","isWindowClosing","activeChanged","setActiveTab","tabInfo","cacheTabId","getFrame","frameProcessId","frameRoutingId","electron","fromId","getFrameId","frame","top","frameTreeNodeId","getParentFrameId","parentFrame","getFrameDetails","errorOccurred","processId","parentFrameId","WebNavigationAPI","sendNavigationEvent","onCreatedNavigationTarget","isInPlace","isMainFrame","sourceTabId","sourceProcessId","sourceFrameId","timeStamp","onBeforeNavigate","onCommitted","httpResponseCode","httpStatusText","onHistoryStateUpdated","transitionType","transitionQualifiers","onDOMContentLoaded","isLoadingMainFrame","onFinishLoad","getAllFrames","targetFrame","mainFrame","framesInSubtree","getWindowState","isMaximized","isMinimized","isFullScreen","getLastFocused","observeWindow","window","onFocusChanged","windowDetailsCache","removeWindow","createWindowDetails","focused","isFocused","getPosition","left","ownerWindow","isPersistent","state","alwaysOnTop","isAlwaysOnTop","sessionId","getWindowDetails","getWindowFromId","getCurrentWindow","getWindowById","getLastFocusedWindow","windows","createWindow","maximize","minimize","restore","removedWindowId","windowDetails","sessionMap","WeakMap","ElectronChromeExtensions","fromSession","modulePath","api","electronSession","defaultSession","ExtensionRouter","ExtensionStore","__dirname","browserAction","contextMenus","commands","notifications","runtime","webNavigation","prependPreload","preloads","getPreloads","preloadPath","preloadIndex","splice","setPreloads","preloadExists","isFile","addTab","selectTab","addExtensionHost","host","warn","getContextMenuItems","addExtension","removeExtension","Extensions","destroyed","usingPreferredSize","readyPromise","isDevToolsOpened","closeDevTools","maybeClose","getFocusedWindow","updatePreferredSize","setSize","updatePosition","movable","maximizable","minimizable","resizable","skipTaskbar","backgroundColor","webPreferences","sandbox","nodeIntegration","nodeIntegrationInWorker","nativeWindowOpen","worldSafeExecuteJavaScript","contextIsolation","enablePreferredSizeMode","untypedWebContents","load","BOUNDS","maxWidth","maxHeight","Promise","resolve","setTimeout","queryPreferredSize","whenReady","rect","min","max","minWidth","minHeight","setBounds","getBounds","winBounds","viewBounds","POSITION_PADDING","executeJavaScript","document","getBoundingClientRect","createDebug","shortenValues","k","v","formatters","r","JSON","stringify","DEFAULT_SESSION","gRoutingDelegate","RoutingDelegate","onRouterMessage","handlerName","args","onExtensionMessage","onRemoteMessage","sessionPartition","ses","fromPartition","onAddListener","listener","onRemoveListener","removeListener","ipcMain","addObserver","eventListenerEquals","eventListener","other","delegate","handlers","listeners","extensionHosts","filterListeners","predicate","filteredListeners","delta","observeListenerHost","eventListeners","existingEventListener","findIndex","getHandler","handler","extEvent","el","ipcName","windowToActiveTab","addWindow","windowHasTabs","getActiveTabFromWindow","wc","fromWebContents","prevActiveTab"],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;;AAEvD;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oDAAU;;AAEnC,OAAO,WAAW;;AAElB;AACA;AACA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;;;;;;;;;;;;AC3QA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,mBAAO,CAAC,sCAAI;AACpC;;AAEA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,WAAW,OAAO;AAClB,YAAY,cAAc;AAC1B;AACA;AACA;AACA;;AAEA,iBAAiB,sBAAsB;AACvC;AACA,aAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,sCAAsC;;AAEtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,aAAa,SAAS;AACtB;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;;AAEA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY,OAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,MAAM;AACjB,YAAY;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACpQA;AACA;AACA;AACA;;AAEA;AACA,kBAAkB,mBAAO,CAAC,yDAAc;AACxC,CAAC;AACD,kBAAkB,mBAAO,CAAC,mDAAW;AACrC;;;;;;;;;;;;ACTA;AACA;AACA;;AAEA,YAAY,mBAAO,CAAC,gBAAK;AACzB,aAAa,mBAAO,CAAC,kBAAM;;AAE3B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,uBAAuB,mBAAO,CAAC,8DAAgB;;AAE/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,4DAA4D;AAC5D;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA,CAAC,IAAI;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,2BAA2B;;AAEnC;AACA;AACA,iDAAiD,EAAE;AACnD,sBAAsB,WAAW,IAAI,KAAK;;AAE1C;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,YAAY,OAAO;AACnB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,gBAAgB,iBAAiB;AACjC;AACA;AACA;;AAEA,iBAAiB,mBAAO,CAAC,oDAAU;;AAEnC,OAAO,WAAW;;AAElB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACtQa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACPA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,cAAc;AACzB,WAAW,OAAO;AAClB,YAAY,MAAM;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,YAAY;AACZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;ACjKa;AACb,WAAW,mBAAO,CAAC,cAAI;AACvB,gBAAgB,mBAAO,CAAC,kDAAU;;AAElC;;AAEA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","/* eslint-env browser */\n\n/**\n * This is the web browser implementation of `debug()`.\n */\n\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.storage = localstorage();\nexports.destroy = (() => {\n\tlet warned = false;\n\n\treturn () => {\n\t\tif (!warned) {\n\t\t\twarned = true;\n\t\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t\t}\n\t};\n})();\n\n/**\n * Colors.\n */\n\nexports.colors = [\n\t'#0000CC',\n\t'#0000FF',\n\t'#0033CC',\n\t'#0033FF',\n\t'#0066CC',\n\t'#0066FF',\n\t'#0099CC',\n\t'#0099FF',\n\t'#00CC00',\n\t'#00CC33',\n\t'#00CC66',\n\t'#00CC99',\n\t'#00CCCC',\n\t'#00CCFF',\n\t'#3300CC',\n\t'#3300FF',\n\t'#3333CC',\n\t'#3333FF',\n\t'#3366CC',\n\t'#3366FF',\n\t'#3399CC',\n\t'#3399FF',\n\t'#33CC00',\n\t'#33CC33',\n\t'#33CC66',\n\t'#33CC99',\n\t'#33CCCC',\n\t'#33CCFF',\n\t'#6600CC',\n\t'#6600FF',\n\t'#6633CC',\n\t'#6633FF',\n\t'#66CC00',\n\t'#66CC33',\n\t'#9900CC',\n\t'#9900FF',\n\t'#9933CC',\n\t'#9933FF',\n\t'#99CC00',\n\t'#99CC33',\n\t'#CC0000',\n\t'#CC0033',\n\t'#CC0066',\n\t'#CC0099',\n\t'#CC00CC',\n\t'#CC00FF',\n\t'#CC3300',\n\t'#CC3333',\n\t'#CC3366',\n\t'#CC3399',\n\t'#CC33CC',\n\t'#CC33FF',\n\t'#CC6600',\n\t'#CC6633',\n\t'#CC9900',\n\t'#CC9933',\n\t'#CCCC00',\n\t'#CCCC33',\n\t'#FF0000',\n\t'#FF0033',\n\t'#FF0066',\n\t'#FF0099',\n\t'#FF00CC',\n\t'#FF00FF',\n\t'#FF3300',\n\t'#FF3333',\n\t'#FF3366',\n\t'#FF3399',\n\t'#FF33CC',\n\t'#FF33FF',\n\t'#FF6600',\n\t'#FF6633',\n\t'#FF9900',\n\t'#FF9933',\n\t'#FFCC00',\n\t'#FFCC33'\n];\n\n/**\n * Currently only WebKit-based Web Inspectors, Firefox >= v31,\n * and the Firebug extension (any Firefox version) are known\n * to support \"%c\" CSS customizations.\n *\n * TODO: add a `localStorage` variable to explicitly enable/disable colors\n */\n\n// eslint-disable-next-line complexity\nfunction useColors() {\n\t// NB: In an Electron preload script, document will be defined but not fully\n\t// initialized. Since we know we're in Chrome, we'll just detect this case\n\t// explicitly\n\tif (typeof window !== 'undefined' && window.process && (window.process.type === 'renderer' || window.process.__nwjs)) {\n\t\treturn true;\n\t}\n\n\t// Internet Explorer and Edge do not support colors.\n\tif (typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/(edge|trident)\\/(\\d+)/)) {\n\t\treturn false;\n\t}\n\n\t// Is webkit? http://stackoverflow.com/a/16459606/376773\n\t// document is undefined in react-native: https://github.com/facebook/react-native/pull/1632\n\treturn (typeof document !== 'undefined' && document.documentElement && document.documentElement.style && document.documentElement.style.WebkitAppearance) ||\n\t\t// Is firebug? http://stackoverflow.com/a/398120/376773\n\t\t(typeof window !== 'undefined' && window.console && (window.console.firebug || (window.console.exception && window.console.table))) ||\n\t\t// Is firefox >= v31?\n\t\t// https://developer.mozilla.org/en-US/docs/Tools/Web_Console#Styling_messages\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/firefox\\/(\\d+)/) && parseInt(RegExp.$1, 10) >= 31) ||\n\t\t// Double check webkit in userAgent just in case we are in a worker\n\t\t(typeof navigator !== 'undefined' && navigator.userAgent && navigator.userAgent.toLowerCase().match(/applewebkit\\/(\\d+)/));\n}\n\n/**\n * Colorize log arguments if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\targs[0] = (this.useColors ? '%c' : '') +\n\t\tthis.namespace +\n\t\t(this.useColors ? ' %c' : ' ') +\n\t\targs[0] +\n\t\t(this.useColors ? '%c ' : ' ') +\n\t\t'+' + module.exports.humanize(this.diff);\n\n\tif (!this.useColors) {\n\t\treturn;\n\t}\n\n\tconst c = 'color: ' + this.color;\n\targs.splice(1, 0, c, 'color: inherit');\n\n\t// The final \"%c\" is somewhat tricky, because there could be other\n\t// arguments passed either before or after the %c, so we need to\n\t// figure out the correct index to insert the CSS into\n\tlet index = 0;\n\tlet lastC = 0;\n\targs[0].replace(/%[a-zA-Z%]/g, match => {\n\t\tif (match === '%%') {\n\t\t\treturn;\n\t\t}\n\t\tindex++;\n\t\tif (match === '%c') {\n\t\t\t// We only are interested in the *last* %c\n\t\t\t// (the user may have provided their own)\n\t\t\tlastC = index;\n\t\t}\n\t});\n\n\targs.splice(lastC, 0, c);\n}\n\n/**\n * Invokes `console.debug()` when available.\n * No-op when `console.debug` is not a \"function\".\n * If `console.debug` is not available, falls back\n * to `console.log`.\n *\n * @api public\n */\nexports.log = console.debug || console.log || (() => {});\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\ttry {\n\t\tif (namespaces) {\n\t\t\texports.storage.setItem('debug', namespaces);\n\t\t} else {\n\t\t\texports.storage.removeItem('debug');\n\t\t}\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\nfunction load() {\n\tlet r;\n\ttry {\n\t\tr = exports.storage.getItem('debug');\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n\n\t// If debug isn't set in LS, and we're in Electron, try to load $DEBUG\n\tif (!r && typeof process !== 'undefined' && 'env' in process) {\n\t\tr = process.env.DEBUG;\n\t}\n\n\treturn r;\n}\n\n/**\n * Localstorage attempts to return the localstorage.\n *\n * This is necessary because safari throws\n * when a user disables cookies/localstorage\n * and you attempt to access it.\n *\n * @return {LocalStorage}\n * @api private\n */\n\nfunction localstorage() {\n\ttry {\n\t\t// TVMLKit (Apple TV JS Runtime) does not have a window object, just localStorage in the global context\n\t\t// The Browser also has localStorage in the global context.\n\t\treturn localStorage;\n\t} catch (error) {\n\t\t// Swallow\n\t\t// XXX (@Qix-) should we be logging these?\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %j to `JSON.stringify()`, since no Web Inspectors do that by default.\n */\n\nformatters.j = function (v) {\n\ttry {\n\t\treturn JSON.stringify(v);\n\t} catch (error) {\n\t\treturn '[UnexpectedJSONParseError]: ' + error.message;\n\t}\n};\n","\n/**\n * This is the common logic for both the Node.js and web browser\n * implementations of `debug()`.\n */\n\nfunction setup(env) {\n\tcreateDebug.debug = createDebug;\n\tcreateDebug.default = createDebug;\n\tcreateDebug.coerce = coerce;\n\tcreateDebug.disable = disable;\n\tcreateDebug.enable = enable;\n\tcreateDebug.enabled = enabled;\n\tcreateDebug.humanize = require('ms');\n\tcreateDebug.destroy = destroy;\n\n\tObject.keys(env).forEach(key => {\n\t\tcreateDebug[key] = env[key];\n\t});\n\n\t/**\n\t* The currently active debug mode names, and names to skip.\n\t*/\n\n\tcreateDebug.names = [];\n\tcreateDebug.skips = [];\n\n\t/**\n\t* Map of special \"%n\" handling functions, for the debug \"format\" argument.\n\t*\n\t* Valid key names are a single, lower or upper-case letter, i.e. \"n\" and \"N\".\n\t*/\n\tcreateDebug.formatters = {};\n\n\t/**\n\t* Selects a color for a debug namespace\n\t* @param {String} namespace The namespace string for the for the debug instance to be colored\n\t* @return {Number|String} An ANSI color code for the given namespace\n\t* @api private\n\t*/\n\tfunction selectColor(namespace) {\n\t\tlet hash = 0;\n\n\t\tfor (let i = 0; i < namespace.length; i++) {\n\t\t\thash = ((hash << 5) - hash) + namespace.charCodeAt(i);\n\t\t\thash |= 0; // Convert to 32bit integer\n\t\t}\n\n\t\treturn createDebug.colors[Math.abs(hash) % createDebug.colors.length];\n\t}\n\tcreateDebug.selectColor = selectColor;\n\n\t/**\n\t* Create a debugger with the given `namespace`.\n\t*\n\t* @param {String} namespace\n\t* @return {Function}\n\t* @api public\n\t*/\n\tfunction createDebug(namespace) {\n\t\tlet prevTime;\n\t\tlet enableOverride = null;\n\n\t\tfunction debug(...args) {\n\t\t\t// Disabled?\n\t\t\tif (!debug.enabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst self = debug;\n\n\t\t\t// Set `diff` timestamp\n\t\t\tconst curr = Number(new Date());\n\t\t\tconst ms = curr - (prevTime || curr);\n\t\t\tself.diff = ms;\n\t\t\tself.prev = prevTime;\n\t\t\tself.curr = curr;\n\t\t\tprevTime = curr;\n\n\t\t\targs[0] = createDebug.coerce(args[0]);\n\n\t\t\tif (typeof args[0] !== 'string') {\n\t\t\t\t// Anything else let's inspect with %O\n\t\t\t\targs.unshift('%O');\n\t\t\t}\n\n\t\t\t// Apply any `formatters` transformations\n\t\t\tlet index = 0;\n\t\t\targs[0] = args[0].replace(/%([a-zA-Z%])/g, (match, format) => {\n\t\t\t\t// If we encounter an escaped % then don't increase the array index\n\t\t\t\tif (match === '%%') {\n\t\t\t\t\treturn '%';\n\t\t\t\t}\n\t\t\t\tindex++;\n\t\t\t\tconst formatter = createDebug.formatters[format];\n\t\t\t\tif (typeof formatter === 'function') {\n\t\t\t\t\tconst val = args[index];\n\t\t\t\t\tmatch = formatter.call(self, val);\n\n\t\t\t\t\t// Now we need to remove `args[index]` since it's inlined in the `format`\n\t\t\t\t\targs.splice(index, 1);\n\t\t\t\t\tindex--;\n\t\t\t\t}\n\t\t\t\treturn match;\n\t\t\t});\n\n\t\t\t// Apply env-specific formatting (colors, etc.)\n\t\t\tcreateDebug.formatArgs.call(self, args);\n\n\t\t\tconst logFn = self.log || createDebug.log;\n\t\t\tlogFn.apply(self, args);\n\t\t}\n\n\t\tdebug.namespace = namespace;\n\t\tdebug.useColors = createDebug.useColors();\n\t\tdebug.color = createDebug.selectColor(namespace);\n\t\tdebug.extend = extend;\n\t\tdebug.destroy = createDebug.destroy; // XXX Temporary. Will be removed in the next major release.\n\n\t\tObject.defineProperty(debug, 'enabled', {\n\t\t\tenumerable: true,\n\t\t\tconfigurable: false,\n\t\t\tget: () => enableOverride === null ? createDebug.enabled(namespace) : enableOverride,\n\t\t\tset: v => {\n\t\t\t\tenableOverride = v;\n\t\t\t}\n\t\t});\n\n\t\t// Env-specific initialization logic for debug instances\n\t\tif (typeof createDebug.init === 'function') {\n\t\t\tcreateDebug.init(debug);\n\t\t}\n\n\t\treturn debug;\n\t}\n\n\tfunction extend(namespace, delimiter) {\n\t\tconst newDebug = createDebug(this.namespace + (typeof delimiter === 'undefined' ? ':' : delimiter) + namespace);\n\t\tnewDebug.log = this.log;\n\t\treturn newDebug;\n\t}\n\n\t/**\n\t* Enables a debug mode by namespaces. This can include modes\n\t* separated by a colon and wildcards.\n\t*\n\t* @param {String} namespaces\n\t* @api public\n\t*/\n\tfunction enable(namespaces) {\n\t\tcreateDebug.save(namespaces);\n\n\t\tcreateDebug.names = [];\n\t\tcreateDebug.skips = [];\n\n\t\tlet i;\n\t\tconst split = (typeof namespaces === 'string' ? namespaces : '').split(/[\\s,]+/);\n\t\tconst len = split.length;\n\n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!split[i]) {\n\t\t\t\t// ignore empty strings\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tnamespaces = split[i].replace(/\\*/g, '.*?');\n\n\t\t\tif (namespaces[0] === '-') {\n\t\t\t\tcreateDebug.skips.push(new RegExp('^' + namespaces.substr(1) + '$'));\n\t\t\t} else {\n\t\t\t\tcreateDebug.names.push(new RegExp('^' + namespaces + '$'));\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t* Disable debug output.\n\t*\n\t* @return {String} namespaces\n\t* @api public\n\t*/\n\tfunction disable() {\n\t\tconst namespaces = [\n\t\t\t...createDebug.names.map(toNamespace),\n\t\t\t...createDebug.skips.map(toNamespace).map(namespace => '-' + namespace)\n\t\t].join(',');\n\t\tcreateDebug.enable('');\n\t\treturn namespaces;\n\t}\n\n\t/**\n\t* Returns true if the given mode name is enabled, false otherwise.\n\t*\n\t* @param {String} name\n\t* @return {Boolean}\n\t* @api public\n\t*/\n\tfunction enabled(name) {\n\t\tif (name[name.length - 1] === '*') {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet i;\n\t\tlet len;\n\n\t\tfor (i = 0, len = createDebug.skips.length; i < len; i++) {\n\t\t\tif (createDebug.skips[i].test(name)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0, len = createDebug.names.length; i < len; i++) {\n\t\t\tif (createDebug.names[i].test(name)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t/**\n\t* Convert regexp to namespace\n\t*\n\t* @param {RegExp} regxep\n\t* @return {String} namespace\n\t* @api private\n\t*/\n\tfunction toNamespace(regexp) {\n\t\treturn regexp.toString()\n\t\t\t.substring(2, regexp.toString().length - 2)\n\t\t\t.replace(/\\.\\*\\?$/, '*');\n\t}\n\n\t/**\n\t* Coerce `val`.\n\t*\n\t* @param {Mixed} val\n\t* @return {Mixed}\n\t* @api private\n\t*/\n\tfunction coerce(val) {\n\t\tif (val instanceof Error) {\n\t\t\treturn val.stack || val.message;\n\t\t}\n\t\treturn val;\n\t}\n\n\t/**\n\t* XXX DO NOT USE. This is a temporary stub function.\n\t* XXX It WILL be removed in the next major release.\n\t*/\n\tfunction destroy() {\n\t\tconsole.warn('Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.');\n\t}\n\n\tcreateDebug.enable(createDebug.load());\n\n\treturn createDebug;\n}\n\nmodule.exports = setup;\n","/**\n * Detect Electron renderer / nwjs process, which is node, but we should\n * treat as a browser.\n */\n\nif (typeof process === 'undefined' || process.type === 'renderer' || process.browser === true || process.__nwjs) {\n\tmodule.exports = require('./browser.js');\n} else {\n\tmodule.exports = require('./node.js');\n}\n","/**\n * Module dependencies.\n */\n\nconst tty = require('tty');\nconst util = require('util');\n\n/**\n * This is the Node.js implementation of `debug()`.\n */\n\nexports.init = init;\nexports.log = log;\nexports.formatArgs = formatArgs;\nexports.save = save;\nexports.load = load;\nexports.useColors = useColors;\nexports.destroy = util.deprecate(\n\t() => {},\n\t'Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.'\n);\n\n/**\n * Colors.\n */\n\nexports.colors = [6, 2, 3, 4, 5, 1];\n\ntry {\n\t// Optional dependency (as in, doesn't need to be installed, NOT like optionalDependencies in package.json)\n\t// eslint-disable-next-line import/no-extraneous-dependencies\n\tconst supportsColor = require('supports-color');\n\n\tif (supportsColor && (supportsColor.stderr || supportsColor).level >= 2) {\n\t\texports.colors = [\n\t\t\t20,\n\t\t\t21,\n\t\t\t26,\n\t\t\t27,\n\t\t\t32,\n\t\t\t33,\n\t\t\t38,\n\t\t\t39,\n\t\t\t40,\n\t\t\t41,\n\t\t\t42,\n\t\t\t43,\n\t\t\t44,\n\t\t\t45,\n\t\t\t56,\n\t\t\t57,\n\t\t\t62,\n\t\t\t63,\n\t\t\t68,\n\t\t\t69,\n\t\t\t74,\n\t\t\t75,\n\t\t\t76,\n\t\t\t77,\n\t\t\t78,\n\t\t\t79,\n\t\t\t80,\n\t\t\t81,\n\t\t\t92,\n\t\t\t93,\n\t\t\t98,\n\t\t\t99,\n\t\t\t112,\n\t\t\t113,\n\t\t\t128,\n\t\t\t129,\n\t\t\t134,\n\t\t\t135,\n\t\t\t148,\n\t\t\t149,\n\t\t\t160,\n\t\t\t161,\n\t\t\t162,\n\t\t\t163,\n\t\t\t164,\n\t\t\t165,\n\t\t\t166,\n\t\t\t167,\n\t\t\t168,\n\t\t\t169,\n\t\t\t170,\n\t\t\t171,\n\t\t\t172,\n\t\t\t173,\n\t\t\t178,\n\t\t\t179,\n\t\t\t184,\n\t\t\t185,\n\t\t\t196,\n\t\t\t197,\n\t\t\t198,\n\t\t\t199,\n\t\t\t200,\n\t\t\t201,\n\t\t\t202,\n\t\t\t203,\n\t\t\t204,\n\t\t\t205,\n\t\t\t206,\n\t\t\t207,\n\t\t\t208,\n\t\t\t209,\n\t\t\t214,\n\t\t\t215,\n\t\t\t220,\n\t\t\t221\n\t\t];\n\t}\n} catch (error) {\n\t// Swallow - we only care if `supports-color` is available; it doesn't have to be.\n}\n\n/**\n * Build up the default `inspectOpts` object from the environment variables.\n *\n *   $ DEBUG_COLORS=no DEBUG_DEPTH=10 DEBUG_SHOW_HIDDEN=enabled node script.js\n */\n\nexports.inspectOpts = Object.keys(process.env).filter(key => {\n\treturn /^debug_/i.test(key);\n}).reduce((obj, key) => {\n\t// Camel-case\n\tconst prop = key\n\t\t.substring(6)\n\t\t.toLowerCase()\n\t\t.replace(/_([a-z])/g, (_, k) => {\n\t\t\treturn k.toUpperCase();\n\t\t});\n\n\t// Coerce string value into JS value\n\tlet val = process.env[key];\n\tif (/^(yes|on|true|enabled)$/i.test(val)) {\n\t\tval = true;\n\t} else if (/^(no|off|false|disabled)$/i.test(val)) {\n\t\tval = false;\n\t} else if (val === 'null') {\n\t\tval = null;\n\t} else {\n\t\tval = Number(val);\n\t}\n\n\tobj[prop] = val;\n\treturn obj;\n}, {});\n\n/**\n * Is stdout a TTY? Colored output is enabled when `true`.\n */\n\nfunction useColors() {\n\treturn 'colors' in exports.inspectOpts ?\n\t\tBoolean(exports.inspectOpts.colors) :\n\t\ttty.isatty(process.stderr.fd);\n}\n\n/**\n * Adds ANSI color escape codes if enabled.\n *\n * @api public\n */\n\nfunction formatArgs(args) {\n\tconst {namespace: name, useColors} = this;\n\n\tif (useColors) {\n\t\tconst c = this.color;\n\t\tconst colorCode = '\\u001B[3' + (c < 8 ? c : '8;5;' + c);\n\t\tconst prefix = `  ${colorCode};1m${name} \\u001B[0m`;\n\n\t\targs[0] = prefix + args[0].split('\\n').join('\\n' + prefix);\n\t\targs.push(colorCode + 'm+' + module.exports.humanize(this.diff) + '\\u001B[0m');\n\t} else {\n\t\targs[0] = getDate() + name + ' ' + args[0];\n\t}\n}\n\nfunction getDate() {\n\tif (exports.inspectOpts.hideDate) {\n\t\treturn '';\n\t}\n\treturn new Date().toISOString() + ' ';\n}\n\n/**\n * Invokes `util.format()` with the specified arguments and writes to stderr.\n */\n\nfunction log(...args) {\n\treturn process.stderr.write(util.format(...args) + '\\n');\n}\n\n/**\n * Save `namespaces`.\n *\n * @param {String} namespaces\n * @api private\n */\nfunction save(namespaces) {\n\tif (namespaces) {\n\t\tprocess.env.DEBUG = namespaces;\n\t} else {\n\t\t// If you set a process.env field to null or undefined, it gets cast to the\n\t\t// string 'null' or 'undefined'. Just delete instead.\n\t\tdelete process.env.DEBUG;\n\t}\n}\n\n/**\n * Load `namespaces`.\n *\n * @return {String} returns the previously persisted debug modes\n * @api private\n */\n\nfunction load() {\n\treturn process.env.DEBUG;\n}\n\n/**\n * Init logic for `debug` instances.\n *\n * Create a new `inspectOpts` object in case `useColors` is set\n * differently for a particular `debug` instance.\n */\n\nfunction init(debug) {\n\tdebug.inspectOpts = {};\n\n\tconst keys = Object.keys(exports.inspectOpts);\n\tfor (let i = 0; i < keys.length; i++) {\n\t\tdebug.inspectOpts[keys[i]] = exports.inspectOpts[keys[i]];\n\t}\n}\n\nmodule.exports = require('./common')(exports);\n\nconst {formatters} = module.exports;\n\n/**\n * Map %o to `util.inspect()`, all on a single line.\n */\n\nformatters.o = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts)\n\t\t.split('\\n')\n\t\t.map(str => str.trim())\n\t\t.join(' ');\n};\n\n/**\n * Map %O to `util.inspect()`, allowing multiple lines if needed.\n */\n\nformatters.O = function (v) {\n\tthis.inspectOpts.colors = this.useColors;\n\treturn util.inspect(v, this.inspectOpts);\n};\n","'use strict';\nmodule.exports = (flag, argv) => {\n\targv = argv || process.argv;\n\tconst prefix = flag.startsWith('-') ? '' : (flag.length === 1 ? '-' : '--');\n\tconst pos = argv.indexOf(prefix + flag);\n\tconst terminatorPos = argv.indexOf('--');\n\treturn pos !== -1 && (terminatorPos === -1 ? true : pos < terminatorPos);\n};\n","/**\n * Helpers.\n */\n\nvar s = 1000;\nvar m = s * 60;\nvar h = m * 60;\nvar d = h * 24;\nvar w = d * 7;\nvar y = d * 365.25;\n\n/**\n * Parse or format the given `val`.\n *\n * Options:\n *\n *  - `long` verbose formatting [false]\n *\n * @param {String|Number} val\n * @param {Object} [options]\n * @throws {Error} throw an error if val is not a non-empty string or a number\n * @return {String|Number}\n * @api public\n */\n\nmodule.exports = function(val, options) {\n  options = options || {};\n  var type = typeof val;\n  if (type === 'string' && val.length > 0) {\n    return parse(val);\n  } else if (type === 'number' && isFinite(val)) {\n    return options.long ? fmtLong(val) : fmtShort(val);\n  }\n  throw new Error(\n    'val is not a non-empty string or a valid number. val=' +\n      JSON.stringify(val)\n  );\n};\n\n/**\n * Parse the given `str` and return milliseconds.\n *\n * @param {String} str\n * @return {Number}\n * @api private\n */\n\nfunction parse(str) {\n  str = String(str);\n  if (str.length > 100) {\n    return;\n  }\n  var match = /^(-?(?:\\d+)?\\.?\\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(\n    str\n  );\n  if (!match) {\n    return;\n  }\n  var n = parseFloat(match[1]);\n  var type = (match[2] || 'ms').toLowerCase();\n  switch (type) {\n    case 'years':\n    case 'year':\n    case 'yrs':\n    case 'yr':\n    case 'y':\n      return n * y;\n    case 'weeks':\n    case 'week':\n    case 'w':\n      return n * w;\n    case 'days':\n    case 'day':\n    case 'd':\n      return n * d;\n    case 'hours':\n    case 'hour':\n    case 'hrs':\n    case 'hr':\n    case 'h':\n      return n * h;\n    case 'minutes':\n    case 'minute':\n    case 'mins':\n    case 'min':\n    case 'm':\n      return n * m;\n    case 'seconds':\n    case 'second':\n    case 'secs':\n    case 'sec':\n    case 's':\n      return n * s;\n    case 'milliseconds':\n    case 'millisecond':\n    case 'msecs':\n    case 'msec':\n    case 'ms':\n      return n;\n    default:\n      return undefined;\n  }\n}\n\n/**\n * Short format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtShort(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return Math.round(ms / d) + 'd';\n  }\n  if (msAbs >= h) {\n    return Math.round(ms / h) + 'h';\n  }\n  if (msAbs >= m) {\n    return Math.round(ms / m) + 'm';\n  }\n  if (msAbs >= s) {\n    return Math.round(ms / s) + 's';\n  }\n  return ms + 'ms';\n}\n\n/**\n * Long format for `ms`.\n *\n * @param {Number} ms\n * @return {String}\n * @api private\n */\n\nfunction fmtLong(ms) {\n  var msAbs = Math.abs(ms);\n  if (msAbs >= d) {\n    return plural(ms, msAbs, d, 'day');\n  }\n  if (msAbs >= h) {\n    return plural(ms, msAbs, h, 'hour');\n  }\n  if (msAbs >= m) {\n    return plural(ms, msAbs, m, 'minute');\n  }\n  if (msAbs >= s) {\n    return plural(ms, msAbs, s, 'second');\n  }\n  return ms + ' ms';\n}\n\n/**\n * Pluralization helper.\n */\n\nfunction plural(ms, msAbs, n, name) {\n  var isPlural = msAbs >= n * 1.5;\n  return Math.round(ms / n) + ' ' + name + (isPlural ? 's' : '');\n}\n","'use strict';\nconst os = require('os');\nconst hasFlag = require('has-flag');\n\nconst env = process.env;\n\nlet forceColor;\nif (hasFlag('no-color') ||\n\thasFlag('no-colors') ||\n\thasFlag('color=false')) {\n\tforceColor = false;\n} else if (hasFlag('color') ||\n\thasFlag('colors') ||\n\thasFlag('color=true') ||\n\thasFlag('color=always')) {\n\tforceColor = true;\n}\nif ('FORCE_COLOR' in env) {\n\tforceColor = env.FORCE_COLOR.length === 0 || parseInt(env.FORCE_COLOR, 10) !== 0;\n}\n\nfunction translateLevel(level) {\n\tif (level === 0) {\n\t\treturn false;\n\t}\n\n\treturn {\n\t\tlevel,\n\t\thasBasic: true,\n\t\thas256: level >= 2,\n\t\thas16m: level >= 3\n\t};\n}\n\nfunction supportsColor(stream) {\n\tif (forceColor === false) {\n\t\treturn 0;\n\t}\n\n\tif (hasFlag('color=16m') ||\n\t\thasFlag('color=full') ||\n\t\thasFlag('color=truecolor')) {\n\t\treturn 3;\n\t}\n\n\tif (hasFlag('color=256')) {\n\t\treturn 2;\n\t}\n\n\tif (stream && !stream.isTTY && forceColor !== true) {\n\t\treturn 0;\n\t}\n\n\tconst min = forceColor ? 1 : 0;\n\n\tif (process.platform === 'win32') {\n\t\t// Node.js 7.5.0 is the first version of Node.js to include a patch to\n\t\t// libuv that enables 256 color output on Windows. Anything earlier and it\n\t\t// won't work. However, here we target Node.js 8 at minimum as it is an LTS\n\t\t// release, and Node.js 7 is not. Windows 10 build 10586 is the first Windows\n\t\t// release that supports 256 colors. Windows 10 build 14931 is the first release\n\t\t// that supports 16m/TrueColor.\n\t\tconst osRelease = os.release().split('.');\n\t\tif (\n\t\t\tNumber(process.versions.node.split('.')[0]) >= 8 &&\n\t\t\tNumber(osRelease[0]) >= 10 &&\n\t\t\tNumber(osRelease[2]) >= 10586\n\t\t) {\n\t\t\treturn Number(osRelease[2]) >= 14931 ? 3 : 2;\n\t\t}\n\n\t\treturn 1;\n\t}\n\n\tif ('CI' in env) {\n\t\tif (['TRAVIS', 'CIRCLECI', 'APPVEYOR', 'GITLAB_CI'].some(sign => sign in env) || env.CI_NAME === 'codeship') {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn min;\n\t}\n\n\tif ('TEAMCITY_VERSION' in env) {\n\t\treturn /^(9\\.(0*[1-9]\\d*)\\.|\\d{2,}\\.)/.test(env.TEAMCITY_VERSION) ? 1 : 0;\n\t}\n\n\tif (env.COLORTERM === 'truecolor') {\n\t\treturn 3;\n\t}\n\n\tif ('TERM_PROGRAM' in env) {\n\t\tconst version = parseInt((env.TERM_PROGRAM_VERSION || '').split('.')[0], 10);\n\n\t\tswitch (env.TERM_PROGRAM) {\n\t\t\tcase 'iTerm.app':\n\t\t\t\treturn version >= 3 ? 3 : 2;\n\t\t\tcase 'Apple_Terminal':\n\t\t\t\treturn 2;\n\t\t\t// No default\n\t\t}\n\t}\n\n\tif (/-256(color)?$/i.test(env.TERM)) {\n\t\treturn 2;\n\t}\n\n\tif (/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM)) {\n\t\treturn 1;\n\t}\n\n\tif ('COLORTERM' in env) {\n\t\treturn 1;\n\t}\n\n\tif (env.TERM === 'dumb') {\n\t\treturn min;\n\t}\n\n\treturn min;\n}\n\nfunction getSupportLevel(stream) {\n\tconst level = supportsColor(stream);\n\treturn translateLevel(level);\n}\n\nmodule.exports = {\n\tsupportsColor: getSupportLevel,\n\tstdout: getSupportLevel(process.stdout),\n\tstderr: getSupportLevel(process.stderr)\n};\n","import { Menu, MenuItem, protocol, nativeImage, app } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { PopupView } from '../popup'\nimport { ExtensionEvent } from '../router'\nimport {\n  getExtensionUrl,\n  getExtensionManifest,\n  getIconPath,\n  resolveExtensionPath,\n  matchSize,\n  ResizeType,\n} from './common'\n\nconst debug = require('debug')('electron-chrome-extensions:browserAction')\n\nif (!app.isReady()) {\n  protocol.registerSchemesAsPrivileged([{ scheme: 'crx', privileges: { bypassCSP: true } }])\n}\n\ninterface ExtensionAction {\n  color?: string\n  text?: string\n  title?: string\n  icon?: chrome.browserAction.TabIconDetails\n  popup?: string\n  /** Last modified date for icon. */\n  iconModified?: number\n}\n\ntype ExtensionActionKey = keyof ExtensionAction\n\ninterface ActivateDetails {\n  eventType: string\n  extensionId: string\n  tabId: number\n  anchorRect: { x: number; y: number; width: number; height: number }\n}\n\nconst getBrowserActionDefaults = (extension: Electron.Extension): ExtensionAction | undefined => {\n  const manifest = getExtensionManifest(extension)\n  const { browser_action } = manifest\n  if (typeof browser_action === 'object') {\n    const action: ExtensionAction = {}\n\n    action.title = browser_action.default_title || manifest.name\n\n    const iconPath = getIconPath(extension)\n    if (iconPath) action.icon = { path: iconPath }\n\n    if (browser_action.default_popup) {\n      action.popup = browser_action.default_popup\n    }\n\n    return action\n  }\n}\n\ninterface ExtensionActionStore extends Partial<ExtensionAction> {\n  tabs: { [key: string]: ExtensionAction }\n}\n\nexport class BrowserActionAPI {\n  private actionMap = new Map</* extensionId */ string, ExtensionActionStore>()\n  private popup?: PopupView\n\n  private observers: Set<Electron.WebContents> = new Set()\n  private queuedUpdate: boolean = false\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n\n    const getter =\n      (propName: ExtensionActionKey) =>\n      ({ extension }: ExtensionEvent, details: chrome.browserAction.TabDetails = {}) => {\n        const { tabId } = details\n        const action = this.getAction(extension.id)\n\n        let result\n\n        if (tabId) {\n          if (action.tabs[tabId]) {\n            result = action.tabs[tabId][propName]\n          } else {\n            result = action[propName]\n          }\n        } else {\n          result = action[propName]\n        }\n\n        return result\n      }\n\n    const setDetails = (\n      { extension }: ExtensionEvent,\n      details: any,\n      propName: ExtensionActionKey\n    ) => {\n      const { tabId } = details\n      let value = (details as any)[propName] || undefined\n\n      if (typeof value === 'undefined') {\n        const defaults = getBrowserActionDefaults(extension)\n        value = defaults ? defaults[propName] : value\n      }\n\n      const valueObj = { [propName]: value }\n      const action = this.getAction(extension.id)\n\n      if (tabId) {\n        const tabAction = action.tabs[tabId] || (action.tabs[tabId] = {})\n        Object.assign(tabAction, valueObj)\n      } else {\n        Object.assign(action, valueObj)\n      }\n\n      this.onUpdate()\n    }\n\n    const setter =\n      (propName: ExtensionActionKey) =>\n      (event: ExtensionEvent, details: chrome.browserAction.TabDetails) =>\n        setDetails(event, details, propName)\n\n    const handleProp = (prop: string, key: ExtensionActionKey) => {\n      handle(`browserAction.get${prop}`, getter(key))\n      handle(`browserAction.set${prop}`, setter(key))\n    }\n\n    handleProp('BadgeBackgroundColor', 'color')\n    handleProp('BadgeText', 'text')\n    handleProp('Title', 'title')\n    handleProp('Popup', 'popup')\n\n    // setIcon is unique in that it can pass in a variety of properties. Here we normalize them\n    // to use 'icon'.\n    handle(\n      'browserAction.setIcon',\n      (event, { tabId, ...details }: chrome.browserAction.TabIconDetails) => {\n        setDetails(event, { tabId, icon: details }, 'icon')\n        setDetails(event, { tabId, iconModified: Date.now() }, 'iconModified')\n      }\n    )\n\n    // browserAction preload API\n    const preloadOpts = { allowRemote: true, extensionContext: false }\n    handle('browserAction.getState', this.getState.bind(this), preloadOpts)\n    handle('browserAction.activate', this.activate.bind(this), preloadOpts)\n    handle(\n      'browserAction.addObserver',\n      (event) => {\n        const { sender: webContents } = event\n        this.observers.add(webContents)\n        webContents.once('destroyed', () => {\n          this.observers.delete(webContents)\n        })\n      },\n      preloadOpts\n    )\n    handle(\n      'browserAction.removeObserver',\n      (event) => {\n        const { sender: webContents } = event\n        this.observers.delete(webContents)\n      },\n      preloadOpts\n    )\n\n    this.ctx.store.on('active-tab-changed', () => {\n      this.onUpdate()\n    })\n\n    // Clear out tab details when removed\n    this.ctx.store.on('tab-removed', (tabId: number) => {\n      for (const [, actionDetails] of this.actionMap) {\n        if (actionDetails.tabs[tabId]) {\n          delete actionDetails.tabs[tabId]\n        }\n      }\n      this.onUpdate()\n    })\n\n    this.setupSession(this.ctx.session)\n  }\n\n  private setupSession(session: Electron.Session) {\n    session.on('extension-loaded', (event, extension) => {\n      this.processExtension(extension)\n    })\n\n    session.on('extension-unloaded', (event, extension) => {\n      this.removeActions(extension.id)\n    })\n\n    session.protocol.registerBufferProtocol('crx', this.handleCrxRequest)\n  }\n\n  private handleCrxRequest = (\n    request: Electron.ProtocolRequest,\n    callback: (response: Electron.ProtocolResponse) => void\n  ) => {\n    debug('%s', request.url)\n\n    let response: Electron.ProtocolResponse\n\n    try {\n      const url = new URL(request.url)\n      const { hostname: requestType } = url\n\n      switch (requestType) {\n        case 'extension-icon': {\n          const tabId = url.searchParams.get('tabId')\n\n          const fragments = url.pathname.split('/')\n          const extensionId = fragments[1]\n          const imageSize = parseInt(fragments[2], 10)\n          const resizeType = parseInt(fragments[3], 10) || ResizeType.Up\n\n          const extension = this.ctx.session.getExtension(extensionId)\n\n          let iconDetails: chrome.browserAction.TabIconDetails | undefined\n\n          const action = this.actionMap.get(extensionId)\n          if (action) {\n            iconDetails = (tabId && action.tabs[tabId]?.icon) || action.icon\n          }\n\n          let iconImage\n\n          if (extension && iconDetails) {\n            if (typeof iconDetails.path === 'string') {\n              const iconAbsPath = resolveExtensionPath(extension, iconDetails.path)\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\n            } else if (typeof iconDetails.path === 'object') {\n              const imagePath = matchSize(iconDetails.path, imageSize, resizeType)\n              const iconAbsPath = imagePath && resolveExtensionPath(extension, imagePath)\n              if (iconAbsPath) iconImage = nativeImage.createFromPath(iconAbsPath)\n            } else if (typeof iconDetails.imageData === 'string') {\n              iconImage = nativeImage.createFromDataURL(iconDetails.imageData)\n            } else if (typeof iconDetails.imageData === 'object') {\n              const imageData = matchSize(iconDetails.imageData as any, imageSize, resizeType)\n              iconImage = imageData ? nativeImage.createFromDataURL(imageData) : undefined\n            }\n          }\n\n          if (iconImage) {\n            response = {\n              statusCode: 200,\n              mimeType: 'image/png',\n              data: iconImage.toPNG(),\n            }\n          } else {\n            response = { statusCode: 400 }\n          }\n\n          break\n        }\n        default: {\n          response = { statusCode: 400 }\n        }\n      }\n    } catch (e) {\n      console.error(e)\n\n      response = {\n        statusCode: 500,\n      }\n    }\n\n    callback(response)\n  }\n\n  private getAction(extensionId: string) {\n    let action = this.actionMap.get(extensionId)\n    if (!action) {\n      action = { tabs: {} }\n      this.actionMap.set(extensionId, action)\n      this.onUpdate()\n    }\n\n    return action\n  }\n\n  // TODO: Make private for v4 major release.\n  removeActions(extensionId: string) {\n    if (this.actionMap.has(extensionId)) {\n      this.actionMap.delete(extensionId)\n    }\n\n    this.onUpdate()\n  }\n\n  private getPopupUrl(extensionId: string, tabId: number) {\n    const action = this.getAction(extensionId)\n    const popupPath = action.tabs[tabId]?.popup || action.popup || undefined\n    return popupPath && `chrome-extension://${extensionId}/${popupPath}`\n  }\n\n  // TODO: Make private for v4 major release.\n  processExtension(extension: Electron.Extension) {\n    const defaultAction = getBrowserActionDefaults(extension)\n    if (defaultAction) {\n      const action = this.getAction(extension.id)\n      Object.assign(action, defaultAction)\n    }\n  }\n\n  private getState() {\n    // Get state without icon data.\n    const actions = Array.from(this.actionMap.entries()).map(([id, details]) => {\n      const { icon, tabs, ...rest } = details\n\n      const tabsInfo: { [key: string]: any } = {}\n\n      for (const tabId of Object.keys(tabs)) {\n        const { icon, ...rest } = tabs[tabId]\n        tabsInfo[tabId] = rest\n      }\n\n      return {\n        id,\n        tabs: tabsInfo,\n        ...rest,\n      }\n    })\n\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\n    return { activeTabId: activeTab?.id, actions }\n  }\n\n  private activate({ sender }: ExtensionEvent, details: ActivateDetails) {\n    const { eventType, extensionId, tabId } = details\n\n    debug(\n      `activate [eventType: ${eventType}, extensionId: '${extensionId}', tabId: ${tabId}, senderId: ${sender.id}]`\n    )\n\n    switch (eventType) {\n      case 'click':\n        this.activateClick(details)\n        break\n      case 'contextmenu':\n        this.activateContextMenu(details)\n        break\n      default:\n        console.debug(`Ignoring unknown browserAction.activate event '${eventType}'`)\n    }\n  }\n\n  private activateClick(details: ActivateDetails) {\n    const { extensionId, tabId, anchorRect } = details\n\n    if (this.popup) {\n      const toggleExtension = !this.popup.isDestroyed() && this.popup.extensionId === extensionId\n      this.popup.destroy()\n      this.popup = undefined\n      if (toggleExtension) {\n        debug('skipping activate to close popup')\n        return\n      }\n    }\n\n    const tab =\n      tabId >= 0 ? this.ctx.store.getTabById(tabId) : this.ctx.store.getActiveTabOfCurrentWindow()\n    if (!tab) {\n      throw new Error(`Unable to get active tab`)\n    }\n\n    const popupUrl = this.getPopupUrl(extensionId, tab.id)\n\n    if (popupUrl) {\n      const win = this.ctx.store.tabToWindow.get(tab)\n      if (!win) {\n        throw new Error('Unable to get BrowserWindow from active tab')\n      }\n\n      this.popup = new PopupView({\n        extensionId,\n        session: this.ctx.session,\n        parent: win,\n        url: popupUrl,\n        anchorRect,\n      })\n\n      debug(`opened popup: ${popupUrl}`)\n\n      this.ctx.emit('browser-action-popup-created', this.popup)\n    } else {\n      debug(`dispatching onClicked for ${extensionId}`)\n\n      const tabDetails = this.ctx.store.tabDetailsCache.get(tab.id)\n      this.ctx.router.sendEvent(extensionId, 'browserAction.onClicked', tabDetails)\n    }\n  }\n\n  private activateContextMenu(details: ActivateDetails) {\n    const { extensionId, anchorRect } = details\n\n    const extension = this.ctx.session.getExtension(extensionId)\n    if (!extension) {\n      throw new Error(`Unregistered extension '${extensionId}'`)\n    }\n\n    const manifest = getExtensionManifest(extension)\n    const menu = new Menu()\n    const append = (opts: Electron.MenuItemConstructorOptions) => menu.append(new MenuItem(opts))\n    const appendSeparator = () => menu.append(new MenuItem({ type: 'separator' }))\n\n    append({\n      label: extension.name,\n      click: () => {\n        const homePageUrl =\n          manifest.homepage_url || `https://chrome.google.com/webstore/detail/${extension.id}`\n        this.ctx.store.createTab({ url: homePageUrl })\n      },\n    })\n\n    appendSeparator()\n\n    const contextMenuItems: MenuItem[] = this.ctx.store.buildMenuItems(\n      extensionId,\n      'browser_action'\n    )\n    if (contextMenuItems.length > 0) {\n      contextMenuItems.forEach((item) => menu.append(item))\n      appendSeparator()\n    }\n\n    const optionsPage = manifest.options_page || manifest.options_ui?.page\n    const optionsPageUrl = optionsPage ? getExtensionUrl(extension, optionsPage) : undefined\n\n    append({\n      label: 'Options',\n      enabled: typeof optionsPageUrl === 'string',\n      click: () => {\n        this.ctx.store.createTab({ url: optionsPageUrl })\n      },\n    })\n\n    menu.popup({\n      x: Math.floor(anchorRect.x),\n      y: Math.floor(anchorRect.y + anchorRect.height),\n    })\n  }\n\n  private onUpdate() {\n    if (this.queuedUpdate) return\n    this.queuedUpdate = true\n    queueMicrotask(() => {\n      this.queuedUpdate = false\n      debug(`dispatching update to ${this.observers.size} observer(s)`)\n      Array.from(this.observers).forEach((observer) => {\n        if (!observer.isDestroyed()) {\n          observer.send('browserAction.update')\n        }\n      })\n    })\n  }\n}\n","import { ExtensionContext } from '../context'\n\n/**\n * Stub implementation for chrome.commands API.\n */\nexport class CommandsAPI {\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('commands.getAll', this.getAll)\n  }\n\n  getAll() {\n    return []\n  }\n}\n","import { promises as fs } from 'fs'\nimport * as path from 'path'\nimport { nativeImage } from 'electron'\n\nexport interface TabContents extends Electron.WebContents {\n  favicon?: string\n}\n\nexport type ContextMenuType =\n  | 'all'\n  | 'page'\n  | 'frame'\n  | 'selection'\n  | 'link'\n  | 'editable'\n  | 'image'\n  | 'video'\n  | 'audio'\n  | 'launcher'\n  | 'browser_action'\n  | 'page_action'\n  | 'action'\n\n/**\n * Get the extension's properly typed Manifest.\n *\n * I can't seem to get TS's merged type declarations working so I'm using this\n * instead for now.\n */\nexport const getExtensionManifest = (extension: Electron.Extension): chrome.runtime.Manifest =>\n  extension.manifest\n\nexport const getExtensionUrl = (extension: Electron.Extension, uri: string) => {\n  try {\n    return new URL(uri, extension.url).href\n  } catch {}\n}\n\nexport const resolveExtensionPath = (extension: Electron.Extension, uri: string) => {\n  const resPath = path.join(extension.path, uri)\n\n  // prevent any parent traversals\n  if (!resPath.startsWith(extension.path)) return\n\n  return resPath\n}\n\nexport const validateExtensionResource = async (extension: Electron.Extension, uri: string) => {\n  const resPath = resolveExtensionPath(extension, uri)\n  if (!resPath) return\n\n  try {\n    await fs.stat(resPath)\n  } catch {\n    return // doesn't exist\n  }\n\n  return resPath\n}\n\nexport enum ResizeType {\n  Exact,\n  Up,\n  Down,\n}\n\nexport const matchSize = (\n  imageSet: { [key: number]: string },\n  size: number,\n  match: ResizeType\n): string | undefined => {\n  // TODO: match based on size\n  const first = parseInt(Object.keys(imageSet).pop()!, 10)\n  return imageSet[first]\n}\n\n/** Gets the relative path to the extension's default icon. */\nexport const getIconPath = (\n  extension: Electron.Extension,\n  iconSize: number = 32,\n  resizeType = ResizeType.Up\n) => {\n  const { browser_action, icons } = getExtensionManifest(extension)\n  const { default_icon } = browser_action || {}\n\n  if (typeof default_icon === 'string') {\n    const iconPath = default_icon\n    return iconPath\n  } else if (typeof default_icon === 'object') {\n    const iconPath = matchSize(default_icon, iconSize, resizeType)\n    return iconPath\n  } else if (typeof icons === 'object') {\n    const iconPath = matchSize(icons, iconSize, resizeType)\n    return iconPath\n  }\n}\n\nexport const getIconImage = (extension: Electron.Extension) => {\n  const iconPath = getIconPath(extension)\n  const iconAbsolutePath = iconPath && resolveExtensionPath(extension, iconPath)\n  return iconAbsolutePath ? nativeImage.createFromPath(iconAbsolutePath) : undefined\n}\n\nconst escapePattern = (pattern: string) => pattern.replace(/[\\\\^$+?.()|[\\]{}]/g, '\\\\$&')\n\n/**\n * @see https://developer.chrome.com/extensions/match_patterns\n */\nexport const matchesPattern = (pattern: string, url: string) => {\n  if (pattern === '<all_urls>') return true\n  const regexp = new RegExp(`^${pattern.split('*').map(escapePattern).join('.*')}$`)\n  return url.match(regexp)\n}\n","import { Menu, MenuItem } from 'electron'\nimport { MenuItemConstructorOptions } from 'electron/main'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { ContextMenuType, getIconImage, matchesPattern } from './common'\n\ntype ContextItemProps = chrome.contextMenus.CreateProperties & { id: string }\n\ntype ContextItemConstructorOptions = {\n  extension: Electron.Extension\n  props: ContextItemProps\n  webContents: Electron.WebContents\n  params?: Electron.ContextMenuParams\n  showIcon?: boolean\n}\n\nconst DEFAULT_CONTEXTS = ['page']\n\nconst getContextTypesFromParams = (params: Electron.ContextMenuParams): Set<ContextMenuType> => {\n  const contexts = new Set<ContextMenuType>(['all'])\n\n  switch (params.mediaType) {\n    case 'audio':\n    case 'video':\n    case 'image':\n      contexts.add(params.mediaType)\n  }\n\n  if (params.pageURL) contexts.add('page')\n  if (params.linkURL) contexts.add('link')\n  if (params.frameURL) contexts.add('frame')\n  if (params.selectionText) contexts.add('selection')\n  if (params.isEditable) contexts.add('editable')\n\n  return contexts\n}\n\nconst formatTitle = (title: string, params: Electron.ContextMenuParams) => {\n  if (params.selectionText && title.includes('%s')) {\n    title = title.split('%s').join(params.selectionText)\n  }\n  return title\n}\n\nconst matchesConditions = (\n  props: ContextItemProps,\n  conditions: {\n    contextTypes: Set<ContextMenuType>\n    targetUrl?: string\n    documentUrl?: string\n  }\n) => {\n  if (props.visible === false) return false\n\n  const { contextTypes, targetUrl, documentUrl } = conditions\n\n  const contexts = props.contexts || DEFAULT_CONTEXTS\n  const inContext = contexts.some((context) => contextTypes.has(context as ContextMenuType))\n  if (!inContext) return false\n\n  if (props.targetUrlPatterns && props.targetUrlPatterns.length > 0 && targetUrl) {\n    if (!props.targetUrlPatterns.some((pattern) => matchesPattern(pattern, targetUrl))) {\n      return false\n    }\n  }\n\n  if (props.documentUrlPatterns && props.documentUrlPatterns.length > 0 && documentUrl) {\n    if (!props.documentUrlPatterns.some((pattern) => matchesPattern(pattern, documentUrl))) {\n      return false\n    }\n  }\n\n  return true\n}\n\nexport class ContextMenusAPI {\n  private menus = new Map<\n    /* extensionId */ string,\n    Map</* menuItemId */ string, ContextItemProps>\n  >()\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('contextMenus.create', this.create)\n    handle('contextMenus.remove', this.remove)\n    handle('contextMenus.removeAll', this.removeAll)\n\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\n      if (this.menus.has(extension.id)) {\n        this.menus.delete(extension.id)\n      }\n    })\n\n    this.ctx.store.buildMenuItems = this.buildMenuItemsForExtension.bind(this)\n  }\n\n  private addContextItem(extensionId: string, props: ContextItemProps) {\n    let contextItems = this.menus.get(extensionId)\n    if (!contextItems) {\n      contextItems = new Map()\n      this.menus.set(extensionId, contextItems)\n    }\n    contextItems.set(props.id, props)\n  }\n\n  private buildMenuItem = (opts: ContextItemConstructorOptions) => {\n    const { extension, props, webContents, params } = opts\n\n    // TODO: try to get the appropriately sized image before resizing\n    let icon = opts.showIcon ? getIconImage(extension) : undefined\n    if (icon) {\n      icon = icon.resize({ width: 16, height: 16 })\n    }\n\n    const menuItemOptions: MenuItemConstructorOptions = {\n      id: props.id,\n      type: props.type as any,\n      label: params ? formatTitle(props.title || '', params) : props.title || '',\n      icon,\n      enabled: props.enabled,\n      click: () => {\n        this.onClicked(extension.id, props.id, webContents, params)\n      },\n    }\n\n    return menuItemOptions\n  }\n\n  private buildMenuItemsFromTemplate = (menuItemTemplates: ContextItemConstructorOptions[]) => {\n    const itemMap = new Map<string, MenuItemConstructorOptions>()\n\n    // Group by ID\n    for (const item of menuItemTemplates) {\n      const menuItem = this.buildMenuItem(item)\n      itemMap.set(item.props.id, menuItem)\n    }\n\n    // Organize in tree\n    for (const item of menuItemTemplates) {\n      const menuItem = itemMap.get(item.props.id)\n      if (item.props.parentId) {\n        const parentMenuItem = itemMap.get(item.props.parentId)\n        if (parentMenuItem) {\n          const submenu = (parentMenuItem.submenu || []) as Electron.MenuItemConstructorOptions[]\n          submenu.push(menuItem!)\n          parentMenuItem.submenu = submenu\n        }\n      }\n    }\n\n    const menuItems: Electron.MenuItem[] = []\n\n    const buildFromTemplate = (opts: Electron.MenuItemConstructorOptions) => {\n      if (Array.isArray(opts.submenu)) {\n        const submenu = new Menu()\n        opts.submenu.forEach((item) => submenu.append(buildFromTemplate(item)))\n        opts.submenu = submenu\n      }\n      return new MenuItem(opts)\n    }\n\n    // Build all final MenuItems in-order\n    for (const item of menuItemTemplates) {\n      // Items with parents will be handled recursively\n      if (item.props.parentId) continue\n\n      const menuItem = itemMap.get(item.props.id)!\n      menuItems.push(buildFromTemplate(menuItem))\n    }\n\n    return menuItems\n  }\n\n  buildMenuItemsForParams(\n    webContents: Electron.WebContents,\n    params: Electron.ContextMenuParams\n  ): Electron.MenuItem[] {\n    if (webContents.session !== this.ctx.session) return []\n\n    const menuItemOptions = []\n\n    const conditions = {\n      contextTypes: getContextTypesFromParams(params),\n      targetUrl: params.srcURL || params.linkURL,\n      documentUrl: params.frameURL || params.pageURL,\n    }\n\n    for (const [extensionId, propItems] of this.menus) {\n      const extension = this.ctx.session.getExtension(extensionId)\n      if (!extension) continue\n\n      for (const [, props] of propItems) {\n        if (matchesConditions(props, conditions)) {\n          const menuItem = {\n            extension,\n            props,\n            webContents,\n            params,\n            showIcon: true,\n          }\n          menuItemOptions.push(menuItem)\n        }\n      }\n    }\n\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\n  }\n\n  private buildMenuItemsForExtension(\n    extensionId: string,\n    menuType: ContextMenuType\n  ): Electron.MenuItem[] {\n    const extensionItems = this.menus.get(extensionId)\n    const extension = this.ctx.session.getExtension(extensionId)\n    const activeTab = this.ctx.store.getActiveTabOfCurrentWindow()\n\n    const menuItemOptions = []\n\n    if (extensionItems && extension && activeTab) {\n      const conditions = {\n        contextTypes: new Set<ContextMenuType>(['all', menuType]),\n      }\n\n      for (const [, props] of extensionItems) {\n        if (matchesConditions(props, conditions)) {\n          const menuItem = { extension, props, webContents: activeTab }\n          menuItemOptions.push(menuItem)\n        }\n      }\n    }\n\n    return this.buildMenuItemsFromTemplate(menuItemOptions)\n  }\n\n  private create = ({ extension }: ExtensionEvent, createProperties: ContextItemProps) => {\n    const { id, type, title } = createProperties\n\n    if (this.menus.has(id)) {\n      // TODO: duplicate error\n      return\n    }\n\n    if (!title && type !== 'separator') {\n      // TODO: error\n      return\n    }\n\n    this.addContextItem(extension.id, createProperties)\n  }\n\n  private remove = ({ extension }: ExtensionEvent, menuItemId: string) => {\n    const items = this.menus.get(extension.id)\n    if (items && items.has(menuItemId)) {\n      items.delete(menuItemId)\n      if (items.size === 0) {\n        this.menus.delete(extension.id)\n      }\n    }\n  }\n\n  private removeAll = ({ extension }: ExtensionEvent) => {\n    this.menus.delete(extension.id)\n  }\n\n  private onClicked(\n    extensionId: string,\n    menuItemId: string,\n    webContents: Electron.WebContents,\n    params?: Electron.ContextMenuParams\n  ) {\n    if (webContents.isDestroyed()) return\n\n    const tab = this.ctx.store.tabDetailsCache.get(webContents.id)\n    if (!tab) {\n      console.error(`[Extensions] Unable to find tab for id=${webContents.id}`)\n      return\n    }\n\n    const data: chrome.contextMenus.OnClickData = {\n      selectionText: params?.selectionText,\n      checked: false, // TODO\n      menuItemId,\n      frameId: -1, // TODO: match frameURL with webFrameMain in Electron 12\n      frameUrl: params?.frameURL,\n      editable: params?.isEditable || false,\n      mediaType: params?.mediaType,\n      wasChecked: false, // TODO\n      pageUrl: params?.pageURL as any, // types are inaccurate\n      linkUrl: params?.linkURL,\n      parentMenuItemId: -1, // TODO\n      srcUrl: params?.srcURL,\n    }\n\n    this.ctx.router.sendEvent(extensionId, 'contextMenus.onClicked', data, tab)\n  }\n}\n","import { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\n\nenum CookieStoreID {\n  Default = '0',\n  Incognito = '1',\n}\n\nconst onChangedCauseTranslation: { [key: string]: string } = {\n  'expired-overwrite': 'expired_overwrite',\n}\n\nconst createCookieDetails = (cookie: Electron.Cookie): chrome.cookies.Cookie => ({\n  ...cookie,\n  domain: cookie.domain || '',\n  hostOnly: Boolean(cookie.hostOnly),\n  session: Boolean(cookie.session),\n  path: cookie.path || '',\n  httpOnly: Boolean(cookie.httpOnly),\n  secure: Boolean(cookie.secure),\n  storeId: CookieStoreID.Default,\n})\n\nexport class CookiesAPI {\n  private get cookies() {\n    return this.ctx.session.cookies\n  }\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('cookies.get', this.get.bind(this))\n    handle('cookies.getAll', this.getAll.bind(this))\n    handle('cookies.set', this.set.bind(this))\n    handle('cookies.remove', this.remove.bind(this))\n    handle('cookies.getAllCookieStores', this.getAllCookieStores.bind(this))\n\n    this.cookies.addListener('changed', this.onChanged)\n  }\n\n  private async get(\n    event: ExtensionEvent,\n    details: chrome.cookies.Details\n  ): Promise<chrome.cookies.Cookie | null> {\n    // TODO: storeId\n    const cookies = await this.cookies.get({\n      url: details.url,\n      name: details.name,\n    })\n\n    // TODO: If more than one cookie of the same name exists for the given URL,\n    // the one with the longest path will be returned. For cookies with the\n    // same path length, the cookie with the earliest creation time will be returned.\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\n  }\n\n  private async getAll(\n    event: ExtensionEvent,\n    details: chrome.cookies.GetAllDetails\n  ): Promise<chrome.cookies.Cookie[]> {\n    // TODO: storeId\n    const cookies = await this.cookies.get({\n      url: details.url,\n      name: details.name,\n      domain: details.domain,\n      path: details.path,\n      secure: details.secure,\n      session: details.session,\n    })\n\n    return cookies.map(createCookieDetails)\n  }\n\n  private async set(\n    event: ExtensionEvent,\n    details: chrome.cookies.SetDetails\n  ): Promise<chrome.cookies.Cookie | null> {\n    await this.cookies.set(details)\n    const cookies = await this.cookies.get(details)\n    return cookies.length > 0 ? createCookieDetails(cookies[0]) : null\n  }\n\n  private async remove(\n    event: ExtensionEvent,\n    details: chrome.cookies.Details\n  ): Promise<chrome.cookies.Details | null> {\n    try {\n      await this.cookies.remove(details.url, details.name)\n    } catch {\n      return null\n    }\n    return details\n  }\n\n  private async getAllCookieStores(event: ExtensionEvent): Promise<chrome.cookies.CookieStore[]> {\n    const tabIds = Array.from(this.ctx.store.tabs)\n      .map((tab) => (tab.isDestroyed() ? undefined : tab.id))\n      .filter(Boolean) as number[]\n    return [{ id: CookieStoreID.Default, tabIds }]\n  }\n\n  private onChanged = (event: Event, cookie: Electron.Cookie, cause: string, removed: boolean) => {\n    const changeInfo: chrome.cookies.CookieChangeInfo = {\n      cause: onChangedCauseTranslation[cause] || cause,\n      cookie: createCookieDetails(cookie),\n      removed,\n    }\n\n    this.ctx.router.broadcastEvent('cookies.onChanged', changeInfo)\n  }\n}\n","import { app, Extension, Notification } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { validateExtensionResource } from './common'\n\nenum TemplateType {\n  Basic = 'basic',\n  Image = 'image',\n  List = 'list',\n  Progress = 'progress',\n}\n\nconst getBody = (opts: chrome.notifications.NotificationOptions) => {\n  const { type = TemplateType.Basic } = opts\n\n  switch (type) {\n    case TemplateType.List: {\n      if (!Array.isArray(opts.items)) {\n        throw new Error('List items must be provided for list type')\n      }\n      return opts.items.map((item) => `${item.title} - ${item.message}`).join('\\n')\n    }\n    default:\n      return opts.message || ''\n  }\n}\n\nconst getUrgency = (\n  priority?: number\n): Required<Electron.NotificationConstructorOptions>['urgency'] => {\n  if (typeof priority !== 'number') {\n    return 'normal'\n  } else if (priority >= 2) {\n    return 'critical'\n  } else if (priority < 0) {\n    return 'low'\n  } else {\n    return 'normal'\n  }\n}\n\nconst createScopedIdentifier = (extension: Extension, id: string) => `${extension.id}-${id}`\nconst stripScopeFromIdentifier = (id: string) => {\n  const index = id.indexOf('-')\n  return id.substr(index + 1)\n}\n\nexport class NotificationsAPI {\n  private registry = new Map<string, Notification>()\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('notifications.clear', this.clear)\n    handle('notifications.create', this.create)\n    handle('notifications.getAll', this.getAll)\n    handle('notifications.getPermissionLevel', this.getPermissionLevel)\n    handle('notifications.update', this.update)\n\n    this.ctx.session.on('extension-unloaded', (event, extension) => {\n      for (const [key, notification] of this.registry) {\n        if (key.startsWith(extension.id)) {\n          notification.close()\n        }\n      }\n    })\n  }\n\n  private clear = ({ extension }: ExtensionEvent, id: string) => {\n    const notificationId = createScopedIdentifier(extension, id)\n    if (this.registry.has(notificationId)) {\n      this.registry.get(notificationId)?.close()\n    }\n  }\n\n  private create = async ({ extension }: ExtensionEvent, arg1: unknown, arg2?: unknown) => {\n    let id: string\n    let opts: chrome.notifications.NotificationOptions\n\n    if (typeof arg1 === 'object') {\n      id = 'guid' // TODO: generate uuid\n      opts = arg1 as chrome.notifications.NotificationOptions\n    } else if (typeof arg1 === 'string') {\n      id = arg1\n      opts = arg2 as chrome.notifications.NotificationOptions\n    } else {\n      throw new Error('Invalid arguments')\n    }\n\n    if (typeof opts !== 'object' || !opts.type || !opts.iconUrl || !opts.title || !opts.message) {\n      throw new Error('Missing required notification options')\n    }\n\n    const notificationId = createScopedIdentifier(extension, id)\n\n    if (this.registry.has(notificationId)) {\n      this.registry.get(notificationId)?.close()\n    }\n\n    let icon\n\n    if (opts.iconUrl) {\n      let url\n      try {\n        url = new URL(opts.iconUrl)\n      } catch {}\n\n      if (url?.protocol === 'data:') {\n        icon = opts.iconUrl\n      } else {\n        icon = await validateExtensionResource(extension, opts.iconUrl)\n      }\n\n      if (!icon) {\n        throw new Error('Invalid iconUrl')\n      }\n    }\n\n    // TODO: buttons, template types\n\n    const notification = new Notification({\n      title: opts.title,\n      subtitle: app.name,\n      body: getBody(opts),\n      silent: opts.silent,\n      icon,\n      urgency: getUrgency(opts.priority),\n      timeoutType: opts.requireInteraction ? 'never' : 'default',\n    })\n\n    this.registry.set(notificationId, notification)\n\n    notification.on('click', () => {\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClicked', id)\n    })\n\n    notification.once('close', () => {\n      const byUser = true // TODO\n      this.ctx.router.sendEvent(extension.id, 'notifications.onClosed', id, byUser)\n      this.registry.delete(notificationId)\n    })\n\n    notification.show()\n\n    return id\n  }\n\n  private getAll = ({ extension }: ExtensionEvent) => {\n    return Array.from(this.registry.keys())\n      .filter((key) => key.startsWith(extension.id))\n      .map(stripScopeFromIdentifier)\n  }\n\n  private getPermissionLevel = (event: ExtensionEvent) => {\n    return Notification.isSupported() ? 'granted' : 'denied'\n  }\n\n  private update = (\n    { extension }: ExtensionEvent,\n    id: string,\n    opts: chrome.notifications.NotificationOptions\n  ) => {\n    const notificationId = createScopedIdentifier(extension, id)\n\n    const notification = this.registry.get(notificationId)\n\n    if (!notification) {\n      return false\n    }\n\n    // TODO: remaining opts\n\n    if (opts.priority) notification.urgency = getUrgency(opts.priority)\n    if (opts.silent) notification.silent = opts.silent\n  }\n}\n","import { EventEmitter } from 'events'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { getExtensionManifest } from './common'\n\nexport class RuntimeAPI extends EventEmitter {\n  constructor(private ctx: ExtensionContext) {\n    super()\n\n    const handle = this.ctx.router.apiHandler()\n    handle('runtime.openOptionsPage', this.openOptionsPage)\n  }\n\n  private openOptionsPage = async ({ extension }: ExtensionEvent) => {\n    // TODO: options page shouldn't appear in Tabs API\n    // https://developer.chrome.com/extensions/options#tabs-api\n\n    const manifest = getExtensionManifest(extension)\n\n    if (manifest.options_ui) {\n      // Embedded option not support (!options_ui.open_in_new_tab)\n      const url = `chrome-extension://${extension.id}/${manifest.options_ui.page}`\n      await this.ctx.store.createTab({ url, active: true })\n    } else if (manifest.options_page) {\n      const url = `chrome-extension://${extension.id}/${manifest.options_page}`\n      await this.ctx.store.createTab({ url, active: true })\n    }\n  }\n}\n","import { BrowserWindow } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\nimport { TabContents } from './common'\nimport { WindowsAPI } from './windows'\n\nconst debug = require('debug')('electron-chrome-extensions:tabs')\n\nexport class TabsAPI {\n  static TAB_ID_NONE = -1\n  static WINDOW_ID_NONE = -1\n  static WINDOW_ID_CURRENT = -2\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('tabs.get', this.get.bind(this))\n    handle('tabs.getAllInWindow', this.getAllInWindow.bind(this))\n    handle('tabs.getCurrent', this.getCurrent.bind(this))\n    handle('tabs.create', this.create.bind(this))\n    handle('tabs.insertCSS', this.insertCSS.bind(this))\n    handle('tabs.query', this.query.bind(this))\n    handle('tabs.reload', this.reload.bind(this))\n    handle('tabs.update', this.update.bind(this))\n    handle('tabs.remove', this.remove.bind(this))\n    handle('tabs.goForward', this.goForward.bind(this))\n    handle('tabs.goBack', this.goBack.bind(this))\n\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\n  }\n\n  private observeTab(tab: TabContents) {\n    const tabId = tab.id\n\n    const updateEvents = [\n      'page-title-updated', // title\n      'did-start-loading', // status\n      'did-stop-loading', // status\n      'media-started-playing', // audible\n      'media-paused', // audible\n      'did-start-navigation', // url\n      'did-redirect-navigation', // url\n      'did-navigate-in-page', // url\n    ]\n\n    const updateHandler = () => {\n      this.onUpdated(tabId)\n    }\n\n    updateEvents.forEach((eventName) => {\n      tab.on(eventName as any, updateHandler)\n    })\n\n    const faviconHandler = (event: Electron.Event, favicons: string[]) => {\n      ;(tab as TabContents).favicon = favicons[0]\n      this.onUpdated(tabId)\n    }\n    tab.on('page-favicon-updated', faviconHandler)\n\n    tab.once('destroyed', () => {\n      updateEvents.forEach((eventName) => {\n        tab.off(eventName as any, updateHandler)\n      })\n      tab.off('page-favicon-updated', faviconHandler)\n\n      this.ctx.store.removeTab(tab)\n      this.onRemoved(tabId)\n    })\n\n    this.onCreated(tabId)\n    this.onActivated(tabId)\n\n    debug(`Observing tab[${tabId}][${tab.getType()}] ${tab.getURL()}`)\n  }\n\n  private createTabDetails(tab: TabContents) {\n    const tabId = tab.id\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\n    let win = this.ctx.store.tabToWindow.get(tab)\n    if (win?.isDestroyed()) win = undefined\n    const [width = 0, height = 0] = win ? win.getSize() : []\n\n    const details: chrome.tabs.Tab = {\n      active: activeTab?.id === tabId,\n      audible: tab.isCurrentlyAudible(),\n      autoDiscardable: true,\n      discarded: false,\n      favIconUrl: tab.favicon || undefined,\n      height,\n      highlighted: false,\n      id: tabId,\n      incognito: false,\n      index: -1, // TODO\n      mutedInfo: { muted: tab.audioMuted },\n      pinned: false,\n      selected: true,\n      status: tab.isLoading() ? 'loading' : 'complete',\n      title: tab.getTitle(),\n      url: tab.getURL(), // TODO: tab.mainFrame.url (Electron 12)\n      width,\n      windowId: win ? win.id : -1,\n    }\n\n    if (typeof this.ctx.store.impl.assignTabDetails === 'function') {\n      this.ctx.store.impl.assignTabDetails(details, tab)\n    }\n\n    this.ctx.store.tabDetailsCache.set(tab.id, details)\n    return details\n  }\n\n  private getTabDetails(tab: TabContents) {\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\n      return this.ctx.store.tabDetailsCache.get(tab.id)\n    }\n    const details = this.createTabDetails(tab)\n    return details\n  }\n\n  private get(event: ExtensionEvent, tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return { id: TabsAPI.TAB_ID_NONE }\n    return this.getTabDetails(tab)\n  }\n\n  private getAllInWindow(event: ExtensionEvent, windowId: number = TabsAPI.WINDOW_ID_CURRENT) {\n    if (windowId === TabsAPI.WINDOW_ID_CURRENT) windowId = this.ctx.store.lastFocusedWindowId!\n\n    const tabs = Array.from(this.ctx.store.tabs).filter((tab) => {\n      if (tab.isDestroyed()) return false\n\n      const browserWindow = this.ctx.store.tabToWindow.get(tab)\n      if (!browserWindow || browserWindow.isDestroyed()) return\n\n      return browserWindow.id === windowId\n    })\n\n    return tabs.map(this.getTabDetails.bind(this))\n  }\n\n  private getCurrent(event: ExtensionEvent) {\n    const tab = this.ctx.store.getActiveTabFromWebContents(event.sender)\n    return tab ? this.getTabDetails(tab) : undefined\n  }\n\n  private async create(event: ExtensionEvent, details: chrome.tabs.CreateProperties = {}) {\n    const tab = await this.ctx.store.createTab(details)\n    const tabDetails = this.getTabDetails(tab)\n    if (details.active) {\n      queueMicrotask(() => this.onActivated(tab.id))\n    }\n    return tabDetails\n  }\n\n  private insertCSS(event: ExtensionEvent, tabId: number, details: chrome.tabs.InjectDetails) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n\n    // TODO: move to webFrame in renderer?\n    if (details.code) {\n      tab.insertCSS(details.code)\n    }\n  }\n\n  private query(event: ExtensionEvent, info: chrome.tabs.QueryInfo = {}) {\n    const isSet = (value: any) => typeof value !== 'undefined'\n\n    const filteredTabs = Array.from(this.ctx.store.tabs)\n      .map(this.getTabDetails.bind(this))\n      .filter((tab) => {\n        if (!tab) return false\n        if (isSet(info.active) && info.active !== tab.active) return false\n        if (isSet(info.pinned) && info.pinned !== tab.pinned) return false\n        if (isSet(info.audible) && info.audible !== tab.audible) return false\n        if (isSet(info.muted) && info.muted !== tab.mutedInfo?.muted) return false\n        if (isSet(info.highlighted) && info.highlighted !== tab.highlighted) return false\n        if (isSet(info.discarded) && info.discarded !== tab.discarded) return false\n        if (isSet(info.autoDiscardable) && info.autoDiscardable !== tab.autoDiscardable)\n          return false\n        // if (isSet(info.currentWindow)) return false\n        // if (isSet(info.lastFocusedWindow)) return false\n        if (isSet(info.status) && info.status !== tab.status) return false\n        if (isSet(info.title) && info.title !== tab.title) return false // TODO: pattern match\n        if (isSet(info.url) && info.url !== tab.url) return false // TODO: match URL pattern\n        if (isSet(info.windowId)) {\n          if (info.windowId === TabsAPI.WINDOW_ID_CURRENT) {\n            if (this.ctx.store.lastFocusedWindowId !== tab.windowId) return false\n          } else if (info.windowId !== tab.windowId) {\n            return false\n          }\n        }\n        // if (isSet(info.windowType) && info.windowType !== tab.windowType) return false\n        // if (isSet(info.index) && info.index !== tab.index) return false\n        return true\n      })\n      .map((tab, index) => {\n        if (tab) {\n          tab.index = index\n        }\n        return tab\n      })\n    return filteredTabs\n  }\n\n  private reload(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\n    const tabId: number | undefined = typeof arg1 === 'number' ? arg1 : undefined\n    const reloadProperties: chrome.tabs.ReloadProperties | null =\n      typeof arg1 === 'object' ? arg1 : typeof arg2 === 'object' ? arg2 : {}\n\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\n\n    if (!tab) return\n\n    if (reloadProperties?.bypassCache) {\n      tab.reloadIgnoringCache()\n    } else {\n      tab.reload()\n    }\n  }\n\n  private async update(event: ExtensionEvent, arg1?: unknown, arg2?: unknown) {\n    let tabId = typeof arg1 === 'number' ? arg1 : undefined\n    const updateProperties: chrome.tabs.UpdateProperties =\n      (typeof arg1 === 'object' ? (arg1 as any) : (arg2 as any)) || {}\n\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\n    if (!tab) return\n\n    tabId = tab.id\n\n    const props = updateProperties\n\n    // TODO: validate URL, prevent 'javascript:'\n    if (props.url) await tab.loadURL(props.url)\n\n    if (typeof props.muted === 'boolean') tab.setAudioMuted(props.muted)\n\n    if (props.active) this.onActivated(tabId)\n\n    this.onUpdated(tabId)\n\n    return this.createTabDetails(tab)\n  }\n\n  private remove(event: ExtensionEvent, id: number | number[]) {\n    const ids = Array.isArray(id) ? id : [id]\n\n    ids.forEach((tabId) => {\n      const tab = this.ctx.store.getTabById(tabId)\n      if (tab) this.ctx.store.removeTab(tab)\n      this.onRemoved(tabId)\n    })\n  }\n\n  private goForward(event: ExtensionEvent, arg1?: unknown) {\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\n    if (!tab) return\n    tab.goForward()\n  }\n\n  private goBack(event: ExtensionEvent, arg1?: unknown) {\n    const tabId = typeof arg1 === 'number' ? arg1 : undefined\n    const tab = tabId\n      ? this.ctx.store.getTabById(tabId)\n      : this.ctx.store.getActiveTabFromWebContents(event.sender)\n    if (!tab) return\n    tab.goBack()\n  }\n\n  onCreated(tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n    const tabDetails = this.getTabDetails(tab)\n    this.ctx.router.broadcastEvent('tabs.onCreated', tabDetails)\n  }\n\n  onUpdated(tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n\n    let prevDetails\n    if (this.ctx.store.tabDetailsCache.has(tab.id)) {\n      prevDetails = this.ctx.store.tabDetailsCache.get(tab.id)\n    }\n    if (!prevDetails) return\n\n    const details = this.createTabDetails(tab)\n\n    const compareProps: (keyof chrome.tabs.Tab)[] = [\n      'status',\n      'url',\n      'pinned',\n      'audible',\n      'discarded',\n      'autoDiscardable',\n      'mutedInfo',\n      'favIconUrl',\n      'title',\n    ]\n\n    let didUpdate = false\n    const changeInfo: chrome.tabs.TabChangeInfo = {}\n\n    for (const prop of compareProps) {\n      if (details[prop] !== prevDetails[prop]) {\n        ;(changeInfo as any)[prop] = details[prop]\n        didUpdate = true\n      }\n    }\n\n    if (!didUpdate) return\n\n    this.ctx.router.broadcastEvent('tabs.onUpdated', tab.id, changeInfo, details)\n  }\n\n  onRemoved(tabId: number) {\n    const details = this.ctx.store.tabDetailsCache.has(tabId)\n      ? this.ctx.store.tabDetailsCache.get(tabId)\n      : null\n    this.ctx.store.tabDetailsCache.delete(tabId)\n\n    const windowId = details ? details.windowId : WindowsAPI.WINDOW_ID_NONE\n    const win =\n      typeof windowId !== 'undefined' && windowId > -1\n        ? BrowserWindow.getAllWindows().find((win) => win.id === windowId)\n        : null\n\n    this.ctx.router.broadcastEvent('tabs.onRemoved', tabId, {\n      windowId,\n      isWindowClosing: win ? win.isDestroyed() : false,\n    })\n  }\n\n  onActivated(tabId: number) {\n    const tab = this.ctx.store.getTabById(tabId)\n    if (!tab) return\n\n    const activeTab = this.ctx.store.getActiveTabFromWebContents(tab)\n    const activeChanged = activeTab?.id !== tabId\n    if (!activeChanged) return\n\n    const win = this.ctx.store.tabToWindow.get(tab)\n\n    this.ctx.store.setActiveTab(tab)\n\n    // invalidate cache since 'active' has changed\n    this.ctx.store.tabDetailsCache.forEach((tabInfo, cacheTabId) => {\n      tabInfo.active = tabId === cacheTabId\n    })\n\n    this.ctx.router.broadcastEvent('tabs.onActivated', {\n      tabId,\n      windowId: win?.id,\n    })\n  }\n}\n","import * as electron from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\n\nconst debug = require('debug')('electron-chrome-extensions:webNavigation')\n\n// https://github.com/electron/electron/pull/25464\nconst getFrame = (frameProcessId: number, frameRoutingId: number) => {\n  return (\n    ('webFrameMain' in electron &&\n      (electron as any).webFrameMain.fromId(frameProcessId, frameRoutingId)) ||\n    null\n  )\n}\n\nconst getFrameId = (frame: any) =>\n  'webFrameMain' in electron ? (frame === frame.top ? 0 : frame.frameTreeNodeId) : -1\n\nconst getParentFrameId = (frame: any) => {\n  const parentFrame = frame?.parent\n  return parentFrame ? getFrameId(parentFrame) : -1\n}\n\nconst getFrameDetails = (frame: any) => ({\n  errorOccurred: false, // TODO\n  processId: frame.processId,\n  frameId: getFrameId(frame),\n  parentFrameId: getParentFrameId(frame),\n  url: frame.url,\n})\n\nexport class WebNavigationAPI {\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('webNavigation.getFrame', this.getFrame.bind(this))\n    handle('webNavigation.getAllFrames', this.getAllFrames.bind(this))\n\n    this.ctx.store.on('tab-added', this.observeTab.bind(this))\n  }\n\n  private observeTab(tab: Electron.WebContents) {\n    tab.once('will-navigate', this.onCreatedNavigationTarget as any)\n    tab.on('did-start-navigation', this.onBeforeNavigate as any)\n    tab.on('did-frame-finish-load', this.onFinishLoad as any)\n    tab.on('did-frame-navigate', this.onCommitted as any)\n    tab.on('did-navigate-in-page', this.onHistoryStateUpdated as any)\n    tab.on('dom-ready', this.onDOMContentLoaded as any)\n  }\n\n  private getFrame(\n    event: ExtensionEvent,\n    details: chrome.webNavigation.GetFrameDetails\n  ): chrome.webNavigation.GetFrameResultDetails | null {\n    const tab = this.ctx.store.getTabById(details.tabId)\n    if (!tab) return null\n\n    let targetFrame: any\n\n    if (typeof details.frameId === 'number') {\n      // https://github.com/electron/electron/pull/25464\n      if ('mainFrame' in tab) {\n        const mainFrame = (tab as any).mainFrame\n        targetFrame = mainFrame.framesInSubtree.find((frame: any) => {\n          const isMainFrame = frame === frame.top\n          return isMainFrame ? details.frameId === 0 : details.frameId === frame.frameTreeNodeId\n        })\n      }\n    }\n\n    return targetFrame ? getFrameDetails(targetFrame) : null\n  }\n\n  private getAllFrames(\n    event: ExtensionEvent,\n    details: chrome.webNavigation.GetFrameDetails\n  ): chrome.webNavigation.GetAllFrameResultDetails[] | null {\n    const tab = this.ctx.store.getTabById(details.tabId)\n    if (!tab || !('mainFrame' in tab)) return []\n    return (tab as any).mainFrame.framesInSubtree.map(getFrameDetails)\n  }\n\n  private sendNavigationEvent = (eventName: string, details: { url: string }) => {\n    debug(`${eventName} [url: ${details.url}]`)\n    this.ctx.router.broadcastEvent(`webNavigation.${eventName}`, details)\n  }\n\n  private onCreatedNavigationTarget = (\n    event: Electron.IpcMainEvent,\n    url: string,\n    isInPlace: boolean,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const tab = event.sender\n    const details: chrome.webNavigation.WebNavigationSourceCallbackDetails = {\n      sourceTabId: tab.id,\n      sourceProcessId: frameProcessId,\n      sourceFrameId: getFrameId(frame),\n      url,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n    }\n    this.sendNavigationEvent('onCreatedNavigationTarget', details)\n  }\n\n  private onBeforeNavigate = (\n    event: Electron.IpcMainEvent,\n    url: string,\n    isInPlace: number,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    if (isInPlace) return\n\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const tab = event.sender\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n\n    this.sendNavigationEvent('onBeforeNavigate', details)\n  }\n\n  private onCommitted = (\n    event: Electron.IpcMainEvent,\n    url: string,\n    httpResponseCode: number,\n    httpStatusText: string,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const tab = event.sender\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onCommitted', details)\n  }\n\n  private onHistoryStateUpdated = (\n    event: Electron.IpcMainEvent,\n    url: string,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const tab = event.sender\n    const details: chrome.webNavigation.WebNavigationTransitionCallbackDetails & {\n      parentFrameId: number\n    } = {\n      transitionType: '', // TODO\n      transitionQualifiers: [], // TODO\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onHistoryStateUpdated', details)\n  }\n\n  private onDOMContentLoaded = (event: Electron.IpcMainEvent) => {\n    const url = event.sender.getURL()\n    // TODO: Add support for iframes\n    // https://github.com/electron/electron/issues/27344\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: 0,\n      parentFrameId: -1,\n      processId: 0,\n      tabId: event.sender.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onDOMContentLoaded', details)\n\n    if (!event.sender.isLoadingMainFrame()) {\n      this.sendNavigationEvent('onCompleted', details)\n    }\n  }\n\n  private onFinishLoad = (\n    event: Electron.IpcMainEvent,\n    isMainFrame: boolean,\n    frameProcessId: number,\n    frameRoutingId: number\n  ) => {\n    const frame = getFrame(frameProcessId, frameRoutingId)\n    const tab = event.sender\n    const url = tab.getURL()\n    const details: chrome.webNavigation.WebNavigationParentedCallbackDetails = {\n      frameId: getFrameId(frame),\n      parentFrameId: getParentFrameId(frame),\n      processId: frameProcessId,\n      tabId: tab.id,\n      timeStamp: Date.now(),\n      url,\n    }\n    this.sendNavigationEvent('onCompleted', details)\n  }\n}\n","import { BrowserWindow } from 'electron'\nimport { ExtensionContext } from '../context'\nimport { ExtensionEvent } from '../router'\n\nconst debug = require('debug')('electron-chrome-extensions:windows')\n\nconst getWindowState = (win: BrowserWindow): chrome.windows.Window['state'] => {\n  if (win.isMaximized()) return 'maximized'\n  if (win.isMinimized()) return 'minimized'\n  if (win.isFullScreen()) return 'fullscreen'\n  return 'normal'\n}\n\nexport class WindowsAPI {\n  static WINDOW_ID_NONE = -1\n  static WINDOW_ID_CURRENT = -2\n\n  constructor(private ctx: ExtensionContext) {\n    const handle = this.ctx.router.apiHandler()\n    handle('windows.get', this.get.bind(this))\n    // TODO: how does getCurrent differ from getLastFocused?\n    handle('windows.getCurrent', this.getLastFocused.bind(this))\n    handle('windows.getLastFocused', this.getLastFocused.bind(this))\n    handle('windows.getAll', this.getAll.bind(this))\n    handle('windows.create', this.create.bind(this))\n    handle('windows.update', this.update.bind(this))\n    handle('windows.remove', this.remove.bind(this))\n\n    this.ctx.store.on('window-added', this.observeWindow.bind(this))\n  }\n\n  private observeWindow(window: Electron.BrowserWindow) {\n    const windowId = window.id\n\n    window.on('focus', () => {\n      this.onFocusChanged(windowId)\n    })\n\n    window.once('closed', () => {\n      this.ctx.store.windowDetailsCache.delete(windowId)\n      this.ctx.store.removeWindow(window)\n      this.onRemoved(windowId)\n    })\n\n    this.onCreated(windowId)\n\n    debug(`Observing window[${windowId}]`)\n  }\n\n  private createWindowDetails(win: BrowserWindow) {\n    const details: Partial<chrome.windows.Window> = {\n      id: win.id,\n      focused: win.isFocused(),\n      top: win.getPosition()[1],\n      left: win.getPosition()[0],\n      width: win.getSize()[0],\n      height: win.getSize()[1],\n      tabs: Array.from(this.ctx.store.tabs)\n        .filter((tab) => {\n          const ownerWindow = this.ctx.store.tabToWindow.get(tab)\n          return ownerWindow?.isDestroyed() ? false : ownerWindow?.id === win.id\n        })\n        .map((tab) => this.ctx.store.tabDetailsCache.get(tab.id) as chrome.tabs.Tab)\n        .filter(Boolean),\n      incognito: !win.webContents.session.isPersistent(),\n      type: 'normal', // TODO\n      state: getWindowState(win),\n      alwaysOnTop: win.isAlwaysOnTop(),\n      sessionId: 'default', // TODO\n    }\n\n    this.ctx.store.windowDetailsCache.set(win.id, details)\n    return details\n  }\n\n  private getWindowDetails(win: BrowserWindow) {\n    if (this.ctx.store.windowDetailsCache.has(win.id)) {\n      return this.ctx.store.windowDetailsCache.get(win.id)\n    }\n    const details = this.createWindowDetails(win)\n    return details\n  }\n\n  private getWindowFromId(id: number) {\n    if (id === WindowsAPI.WINDOW_ID_CURRENT) {\n      return this.ctx.store.getCurrentWindow()\n    } else {\n      return this.ctx.store.getWindowById(id)\n    }\n  }\n\n  private get(event: ExtensionEvent, windowId: number) {\n    const win = this.getWindowFromId(windowId)\n    if (!win) return { id: WindowsAPI.WINDOW_ID_NONE }\n    return this.getWindowDetails(win)\n  }\n\n  private getLastFocused(event: ExtensionEvent) {\n    const win = this.ctx.store.getLastFocusedWindow()\n    return win ? this.getWindowDetails(win) : null\n  }\n\n  private getAll(event: ExtensionEvent) {\n    return Array.from(this.ctx.store.windows).map(this.getWindowDetails.bind(this))\n  }\n\n  private async create(event: ExtensionEvent, details: chrome.windows.CreateData) {\n    const win = await this.ctx.store.createWindow(event, details)\n    return this.getWindowDetails(win)\n  }\n\n  private async update(\n    event: ExtensionEvent,\n    windowId: number,\n    updateProperties: chrome.windows.UpdateInfo = {}\n  ) {\n    const win = this.getWindowFromId(windowId)\n    if (!win) return\n\n    const props = updateProperties\n\n    if (props.state) {\n      switch (props.state) {\n        case 'maximized':\n          win.maximize()\n          break\n        case 'minimized':\n          win.minimize()\n          break\n        case 'normal': {\n          if (win.isMinimized() || win.isMaximized()) {\n            win.restore()\n          }\n          break\n        }\n      }\n    }\n\n    return this.createWindowDetails(win)\n  }\n\n  private async remove(event: ExtensionEvent, windowId: number = WindowsAPI.WINDOW_ID_CURRENT) {\n    const win = this.getWindowFromId(windowId)\n    if (!win) return\n    const removedWindowId = win.id\n    await this.ctx.store.removeWindow(win)\n    this.onRemoved(removedWindowId)\n  }\n\n  onCreated(windowId: number) {\n    const window = this.ctx.store.getWindowById(windowId)\n    if (!window) return\n    const windowDetails = this.getWindowDetails(window)\n    this.ctx.router.broadcastEvent('windows.onCreated', windowDetails)\n  }\n\n  onRemoved(windowId: number) {\n    this.ctx.router.broadcastEvent('windows.onRemoved', windowId)\n  }\n\n  onFocusChanged(windowId: number) {\n    if (this.ctx.store.lastFocusedWindowId === windowId) return\n\n    this.ctx.store.lastFocusedWindowId = windowId\n    this.ctx.router.broadcastEvent('windows.onFocusChanged', windowId)\n  }\n}\n","import { app, session as electronSession } from 'electron'\nimport { EventEmitter } from 'events'\nimport path from 'path'\nimport { promises as fs } from 'fs'\n\nimport { BrowserActionAPI } from './api/browser-action'\nimport { TabsAPI } from './api/tabs'\nimport { WindowsAPI } from './api/windows'\nimport { WebNavigationAPI } from './api/web-navigation'\nimport { ExtensionStore } from './store'\nimport { ContextMenusAPI } from './api/context-menus'\nimport { RuntimeAPI } from './api/runtime'\nimport { CookiesAPI } from './api/cookies'\nimport { NotificationsAPI } from './api/notifications'\nimport { ChromeExtensionImpl } from './impl'\nimport { CommandsAPI } from './api/commands'\nimport { ExtensionContext } from './context'\nimport { ExtensionRouter } from './router'\n\nexport interface ChromeExtensionOptions extends ChromeExtensionImpl {\n  session?: Electron.Session\n\n  /**\n   * Path to electron-chrome-extensions module files. Might be needed if\n   * JavaScript bundlers like Webpack are used in your build process.\n   */\n  modulePath?: string\n}\n\nconst sessionMap = new WeakMap<Electron.Session, ElectronChromeExtensions>()\n\n/**\n * Provides an implementation of various Chrome extension APIs to a session.\n */\nexport class ElectronChromeExtensions extends EventEmitter {\n  /** Retrieve an instance of this class associated with the given session. */\n  static fromSession(session: Electron.Session) {\n    return sessionMap.get(session)\n  }\n\n  private ctx: ExtensionContext\n  private modulePath: string\n\n  private api: {\n    browserAction: BrowserActionAPI\n    contextMenus: ContextMenusAPI\n    commands: CommandsAPI\n    cookies: CookiesAPI\n    notifications: NotificationsAPI\n    runtime: RuntimeAPI\n    tabs: TabsAPI\n    webNavigation: WebNavigationAPI\n    windows: WindowsAPI\n  }\n\n  constructor(opts?: ChromeExtensionOptions) {\n    super()\n\n    const { session = electronSession.defaultSession, modulePath, ...impl } = opts || {}\n\n    if (sessionMap.has(session)) {\n      throw new Error(`Extensions instance already exists for the given session`)\n    }\n\n    sessionMap.set(session, this)\n\n    const router = new ExtensionRouter(session)\n    const store = new ExtensionStore(impl)\n\n    this.ctx = {\n      emit: this.emit.bind(this),\n      router,\n      session,\n      store,\n    }\n\n    this.modulePath = modulePath || path.join(__dirname, '..')\n\n    this.api = {\n      browserAction: new BrowserActionAPI(this.ctx),\n      contextMenus: new ContextMenusAPI(this.ctx),\n      commands: new CommandsAPI(this.ctx),\n      cookies: new CookiesAPI(this.ctx),\n      notifications: new NotificationsAPI(this.ctx),\n      runtime: new RuntimeAPI(this.ctx),\n      tabs: new TabsAPI(this.ctx),\n      webNavigation: new WebNavigationAPI(this.ctx),\n      windows: new WindowsAPI(this.ctx),\n    }\n\n    this.prependPreload()\n  }\n\n  private async prependPreload() {\n    const { session } = this.ctx\n    let preloads = session.getPreloads()\n\n    const preloadPath = path.join(this.modulePath, 'dist/preload.js')\n\n    const preloadIndex = preloads.indexOf(preloadPath)\n    if (preloadIndex > -1) {\n      preloads.splice(preloadIndex, 1)\n    }\n\n    preloads = [preloadPath, ...preloads]\n    session.setPreloads(preloads)\n\n    let preloadExists = false\n    try {\n      const stat = await fs.stat(preloadPath)\n      preloadExists = stat.isFile()\n    } catch {}\n\n    if (!preloadExists) {\n      console.error(\n        `Unable to access electron-chrome-extensions preload file (${preloadPath}). Consider configuring the 'modulePath' constructor option.`\n      )\n    }\n  }\n\n  /** Add webContents to be tracked as a tab. */\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\n    this.ctx.store.addTab(tab, window)\n  }\n\n  /** Notify extension system that the active tab has changed. */\n  selectTab(tab: Electron.WebContents) {\n    if (this.ctx.store.tabs.has(tab)) {\n      this.api.tabs.onActivated(tab.id)\n    }\n  }\n\n  /**\n   * Add webContents to be tracked as an extension host which will receive\n   * extension events when a chrome-extension:// resource is loaded.\n   *\n   * This is usually reserved for extension background pages and popups, but\n   * can also be used in other special cases.\n   *\n   * @deprecated Extension hosts are now tracked lazily when they send\n   * extension IPCs to the main process.\n   */\n  addExtensionHost(host: Electron.WebContents) {\n    console.warn('ElectronChromeExtensions.addExtensionHost() is deprecated')\n  }\n\n  /**\n   * Get collection of menu items managed by the `chrome.contextMenus` API.\n   * @see https://developer.chrome.com/extensions/contextMenus\n   */\n  getContextMenuItems(webContents: Electron.WebContents, params: Electron.ContextMenuParams) {\n    return this.api.contextMenus.buildMenuItemsForParams(webContents, params)\n  }\n\n  /**\n   * Add extensions to be visible as an extension action button.\n   *\n   * @deprecated Not needed in Electron >=12.\n   */\n  addExtension(extension: Electron.Extension) {\n    console.warn('ElectronChromeExtensions.addExtension() is deprecated')\n    this.api.browserAction.processExtension(extension)\n  }\n\n  /**\n   * Remove extensions from the list of visible extension action buttons.\n   *\n   * @deprecated Not needed in Electron >=12.\n   */\n  removeExtension(extension: Electron.Extension) {\n    console.warn('ElectronChromeExtensions.removeExtension() is deprecated')\n    this.api.browserAction.removeActions(extension.id)\n  }\n}\n\n/**\n * @deprecated Use `ElectronChromeExtensions` instead.\n */\nexport const Extensions = ElectronChromeExtensions\n","import { BrowserWindow, Session } from 'electron'\n\nconst debug = require('debug')('electron-chrome-extensions:popup')\n\nexport interface PopupAnchorRect {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\ninterface PopupViewOptions {\n  extensionId: string\n  session: Session\n  parent: BrowserWindow\n  url: string\n  anchorRect: PopupAnchorRect\n}\n\nexport class PopupView {\n  static POSITION_PADDING = 5\n\n  static BOUNDS = {\n    minWidth: 25,\n    minHeight: 25,\n    maxWidth: 800,\n    maxHeight: 600,\n  }\n\n  browserWindow?: BrowserWindow\n  parent?: BrowserWindow\n  extensionId: string\n\n  private anchorRect: PopupAnchorRect\n  private destroyed: boolean = false\n\n  /** Preferred size changes are only received in Electron v12+ */\n  private usingPreferredSize = false\n\n  private readyPromise: Promise<void>\n\n  constructor(opts: PopupViewOptions) {\n    this.parent = opts.parent\n    this.extensionId = opts.extensionId\n    this.anchorRect = opts.anchorRect\n\n    this.browserWindow = new BrowserWindow({\n      show: false,\n      frame: false,\n      parent: opts.parent,\n      movable: false,\n      maximizable: false,\n      minimizable: false,\n      resizable: false,\n      skipTaskbar: true,\n      backgroundColor: '#ffffff',\n      webPreferences: {\n        session: opts.session,\n        sandbox: true,\n        nodeIntegration: false,\n        nodeIntegrationInWorker: false,\n        nativeWindowOpen: true,\n        worldSafeExecuteJavaScript: true,\n        contextIsolation: true,\n        ...({\n          enablePreferredSizeMode: true,\n        } as any),\n      },\n    })\n\n    const untypedWebContents = this.browserWindow.webContents as any\n    untypedWebContents.on('preferred-size-changed', this.updatePreferredSize)\n\n    this.browserWindow.webContents.on('devtools-closed', this.maybeClose)\n    this.browserWindow.on('blur', this.maybeClose)\n    this.browserWindow.on('closed', this.destroy)\n    this.parent.once('closed', this.destroy)\n\n    this.readyPromise = this.load(opts.url)\n  }\n\n  private async load(url: string): Promise<void> {\n    const win = this.browserWindow!\n\n    try {\n      await win.webContents.loadURL(url)\n    } catch (e) {\n      console.error(e)\n    }\n\n    if (this.destroyed) return\n\n    if (!this.usingPreferredSize) {\n      // Set large initial size to avoid overflow\n      this.setSize({ width: PopupView.BOUNDS.maxWidth, height: PopupView.BOUNDS.maxHeight })\n\n      // Wait for content and layout to load\n      await new Promise((resolve) => setTimeout(resolve, 100))\n      if (this.destroyed) return\n\n      await this.queryPreferredSize()\n      if (this.destroyed) return\n    }\n\n    win.show()\n  }\n\n  destroy = () => {\n    if (this.destroyed) return\n\n    this.destroyed = true\n\n    debug(`destroying ${this.extensionId}`)\n\n    if (this.parent) {\n      if (!this.parent.isDestroyed()) {\n        this.parent.off('closed', this.destroy)\n      }\n      this.parent = undefined\n    }\n\n    if (this.browserWindow) {\n      if (!this.browserWindow.isDestroyed()) {\n        const { webContents } = this.browserWindow\n\n        if (!webContents.isDestroyed() && webContents.isDevToolsOpened()) {\n          webContents.closeDevTools()\n        }\n\n        this.browserWindow.off('closed', this.destroy)\n        this.browserWindow.destroy()\n      }\n\n      this.browserWindow = undefined\n    }\n  }\n\n  isDestroyed() {\n    return this.destroyed\n  }\n\n  /** Resolves when the popup finishes loading. */\n  whenReady() {\n    return this.readyPromise\n  }\n\n  setSize(rect: Partial<Electron.Rectangle>) {\n    if (!this.browserWindow || !this.parent) return\n\n    const width = Math.floor(\n      Math.min(PopupView.BOUNDS.maxWidth, Math.max(rect.width || 0, PopupView.BOUNDS.minWidth))\n    )\n\n    const height = Math.floor(\n      Math.min(PopupView.BOUNDS.maxHeight, Math.max(rect.height || 0, PopupView.BOUNDS.minHeight))\n    )\n\n    debug(`setSize`, { width, height })\n\n    this.browserWindow?.setBounds({\n      ...this.browserWindow.getBounds(),\n      width,\n      height,\n    })\n  }\n\n  private maybeClose = () => {\n    // Keep open if webContents is being inspected\n    if (!this.browserWindow?.isDestroyed() && this.browserWindow?.webContents.isDevToolsOpened()) {\n      debug('preventing close due to DevTools being open')\n      return\n    }\n\n    // For extension popups with a login form, the user may need to access a\n    // program outside of the app. Closing the popup would then add\n    // inconvenience.\n    if (!BrowserWindow.getFocusedWindow()) {\n      debug('preventing close due to focus residing outside of the app')\n      return\n    }\n\n    this.destroy()\n  }\n\n  private updatePosition() {\n    if (!this.browserWindow || !this.parent) return\n\n    const winBounds = this.parent.getBounds()\n    const viewBounds = this.browserWindow.getBounds()\n\n    // TODO: support more orientations than just top-right\n    let x = winBounds.x + this.anchorRect.x + this.anchorRect.width - viewBounds.width\n    let y = winBounds.y + this.anchorRect.y + this.anchorRect.height + PopupView.POSITION_PADDING\n\n    // Convert to ints\n    x = Math.floor(x)\n    y = Math.floor(y)\n\n    debug(`updatePosition`, { x, y })\n\n    this.browserWindow.setBounds({\n      ...this.browserWindow.getBounds(),\n      x,\n      y,\n    })\n  }\n\n  /** Backwards compat for Electron <12 */\n  private async queryPreferredSize() {\n    if (this.usingPreferredSize || this.destroyed) return\n\n    const rect = await this.browserWindow!.webContents.executeJavaScript(\n      `((${() => {\n        const rect = document.body.getBoundingClientRect()\n        return { width: rect.width, height: rect.height }\n      }})())`\n    )\n\n    if (this.destroyed) return\n\n    this.setSize({ width: rect.width, height: rect.height })\n    this.updatePosition()\n  }\n\n  private updatePreferredSize = (event: Electron.Event, size: Electron.Size) => {\n    debug('updatePreferredSize', size)\n    this.usingPreferredSize = true\n    this.setSize(size)\n    this.updatePosition()\n  }\n}\n","import { app, Extension, ipcMain, session, Session, WebContents } from 'electron'\n\nconst createDebug = require('debug')\n\n// Shorten base64 encoded icons\nconst shortenValues = (k: string, v: any) =>\n  typeof v === 'string' && v.length > 128 ? v.substr(0, 128) + '...' : v\n\ncreateDebug.formatters.r = (value: any) => {\n  return value ? JSON.stringify(value, shortenValues, '  ') : value\n}\n\nconst debug = createDebug('electron-chrome-extensions:router')\n\nconst DEFAULT_SESSION = '_self'\n\ninterface RoutingDelegateObserver {\n  session: Electron.Session\n  onExtensionMessage(\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string | undefined,\n    handlerName: string,\n    ...args: any[]\n  ): Promise<void>\n  addListener(listener: EventListener, extensionId: string, eventName: string): void\n  removeListener(listener: EventListener, extensionId: string, eventName: string): void\n}\n\nlet gRoutingDelegate: RoutingDelegate\n\n/**\n * Handles event routing IPCs and delivers them to the observer with the\n * associated session.\n */\nclass RoutingDelegate {\n  static get() {\n    return gRoutingDelegate || (gRoutingDelegate = new RoutingDelegate())\n  }\n\n  private sessionMap: WeakMap<Session, RoutingDelegateObserver> = new WeakMap()\n\n  private constructor() {\n    ipcMain.handle('crx-msg', this.onRouterMessage)\n    ipcMain.handle('crx-msg-remote', this.onRemoteMessage)\n    ipcMain.on('crx-add-listener', this.onAddListener)\n    ipcMain.on('crx-remove-listener', this.onRemoveListener)\n  }\n\n  addObserver(observer: RoutingDelegateObserver) {\n    this.sessionMap.set(observer.session, observer)\n  }\n\n  private onRouterMessage = async (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    handlerName: string,\n    ...args: any[]\n  ) => {\n    debug(`received '${handlerName}'`, args)\n\n    const observer = this.sessionMap.get(event.sender.session)\n\n    return observer?.onExtensionMessage(event, extensionId, handlerName, ...args)\n  }\n\n  private onRemoteMessage = async (\n    event: Electron.IpcMainInvokeEvent,\n    sessionPartition: string,\n    handlerName: string,\n    ...args: any[]\n  ) => {\n    debug(`received remote '${handlerName}' for '${sessionPartition}'`, args)\n\n    const ses =\n      sessionPartition === DEFAULT_SESSION\n        ? event.sender.session\n        : session.fromPartition(sessionPartition)\n\n    const observer = this.sessionMap.get(ses)\n\n    return observer?.onExtensionMessage(event, undefined, handlerName, ...args)\n  }\n\n  private onAddListener = (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    eventName: string\n  ) => {\n    const observer = this.sessionMap.get(event.sender.session)\n    const listener: EventListener = { host: event.sender, extensionId }\n    return observer?.addListener(listener, extensionId, eventName)\n  }\n\n  private onRemoveListener = (\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string,\n    eventName: string\n  ) => {\n    const observer = this.sessionMap.get(event.sender.session)\n    const listener: EventListener = { host: event.sender, extensionId }\n    return observer?.removeListener(listener, extensionId, eventName)\n  }\n}\n\nexport interface ExtensionEvent {\n  sender: WebContents\n  extension: Extension\n}\n\nexport type HandlerCallback = (event: ExtensionEvent, ...args: any[]) => any\n\nexport interface HandlerOptions {\n  /** Whether the handler can be invoked on behalf of a different session. */\n  allowRemote?: boolean\n  /** Whether an extension context is required to invoke the handler. */\n  extensionContext: boolean\n}\n\ninterface Handler extends HandlerOptions {\n  callback: HandlerCallback\n}\n\n/** e.g. 'tabs.query' */\ntype EventName = string\n\ntype HandlerMap = Map<EventName, Handler>\n\ninterface EventListener {\n  host: Electron.WebContents\n  extensionId: string\n}\n\nconst eventListenerEquals = (eventListener: EventListener) => (other: EventListener) =>\n  other.host === eventListener.host && other.extensionId === eventListener.extensionId\n\nexport class ExtensionRouter {\n  private handlers: HandlerMap = new Map()\n  private listeners: Map<EventName, EventListener[]> = new Map()\n\n  /**\n   * Collection of all extension hosts in the session.\n   *\n   * Currently the router has no ability to wake up non-persistent background\n   * scripts to deliver events. For now we just hold a reference to them to\n   * prevent them from being terminated.\n   */\n  private extensionHosts: Set<Electron.WebContents> = new Set()\n\n  constructor(\n    public session: Electron.Session,\n    private delegate: RoutingDelegate = RoutingDelegate.get()\n  ) {\n    this.delegate.addObserver(this)\n\n    session.on('extension-unloaded', (event, extension) => {\n      this.filterListeners((listener) => listener.extensionId !== extension.id)\n    })\n\n    app.on('web-contents-created', (event, webContents) => {\n      if (webContents.session === this.session && webContents.getType() === 'backgroundPage') {\n        debug(`storing reference to background host [url:'${webContents.getURL()}']`)\n        this.extensionHosts.add(webContents)\n      }\n    })\n  }\n\n  private filterListeners(predicate: (listener: EventListener) => boolean) {\n    for (const [eventName, listeners] of this.listeners) {\n      const filteredListeners = listeners.filter(predicate)\n      const delta = listeners.length - filteredListeners.length\n\n      if (filteredListeners.length > 0) {\n        this.listeners.set(eventName, filteredListeners)\n      } else {\n        this.listeners.delete(eventName)\n      }\n\n      if (delta > 0) {\n        debug(`removed ${delta} listener(s) for '${eventName}'`)\n      }\n    }\n  }\n\n  private observeListenerHost(host: Electron.WebContents) {\n    debug(`observing listener [id:${host.id}, url:'${host.getURL()}']`)\n    host.once('destroyed', () => {\n      debug(`extension host destroyed [id:${host.id}]`)\n      this.filterListeners((listener) => listener.host !== host)\n    })\n  }\n\n  addListener(listener: EventListener, extensionId: string, eventName: string) {\n    const { listeners, session } = this\n\n    const extension = session.getExtension(extensionId)\n    if (!extension) {\n      throw new Error(`extension not registered in session [extensionId:${extensionId}]`)\n    }\n\n    if (!listeners.has(eventName)) {\n      listeners.set(eventName, [])\n    }\n\n    const eventListeners = listeners.get(eventName)!\n    const existingEventListener = eventListeners.find(eventListenerEquals(listener))\n\n    if (existingEventListener) {\n      debug(`ignoring existing '${eventName}' event listener for ${extensionId}`)\n    } else {\n      debug(`adding '${eventName}' event listener for ${extensionId}`)\n      eventListeners.push(listener)\n      this.observeListenerHost(listener.host)\n    }\n  }\n\n  removeListener(listener: EventListener, extensionId: string, eventName: string) {\n    const { listeners } = this\n\n    const eventListeners = listeners.get(eventName)\n    if (!eventListeners) {\n      console.error(`event listener not registered for '${eventName}'`)\n      return\n    }\n\n    const index = eventListeners.findIndex(eventListenerEquals(listener))\n\n    if (index >= 0) {\n      debug(`removing '${eventName}' event listener for ${extensionId}`)\n      eventListeners.splice(index, 1)\n    }\n\n    if (eventListeners.length === 0) {\n      listeners.delete(eventName)\n    }\n  }\n\n  private getHandler(handlerName: string) {\n    const handler = this.handlers.get(handlerName)\n    if (!handler) {\n      throw new Error(`${handlerName} is not a registered handler`)\n    }\n\n    return handler\n  }\n\n  async onExtensionMessage(\n    event: Electron.IpcMainInvokeEvent,\n    extensionId: string | undefined,\n    handlerName: string,\n    ...args: any[]\n  ) {\n    const { session } = this\n    const { sender } = event\n    const handler = this.getHandler(handlerName)\n\n    if (sender.session !== session && !handler.allowRemote) {\n      throw new Error(`${handlerName} does not support calling from a remote session`)\n    }\n\n    const extension = extensionId ? sender.session.getExtension(extensionId) : undefined\n    if (!extension && handler.extensionContext) {\n      throw new Error(`${handlerName} was sent from an unknown extension context`)\n    }\n\n    const extEvent = {\n      sender,\n      extension: extension!,\n    }\n\n    const result = await handler.callback(extEvent, ...args)\n\n    debug(`${handlerName} result: %r`, result)\n\n    return result\n  }\n\n  private handle(name: string, callback: HandlerCallback, opts?: HandlerOptions): void {\n    this.handlers.set(name, {\n      callback,\n      extensionContext: typeof opts?.extensionContext === 'boolean' ? opts.extensionContext : true,\n      allowRemote: typeof opts?.allowRemote === 'boolean' ? opts.allowRemote : false,\n    })\n  }\n\n  /** Returns a callback to register API handlers for the given context. */\n  apiHandler() {\n    return (name: string, callback: HandlerCallback, opts?: HandlerOptions) => {\n      this.handle(name, callback, opts)\n    }\n  }\n\n  /**\n   * Sends extension event to the host for the given extension ID if it\n   * registered a listener for it.\n   */\n  sendEvent(extensionId: string | undefined, eventName: string, ...args: any[]) {\n    const { listeners } = this\n\n    let eventListeners = listeners.get(eventName)\n\n    if (extensionId) {\n      // TODO: extension permissions check\n\n      eventListeners = eventListeners?.filter((el) => el.extensionId === extensionId)\n    }\n\n    if (!eventListeners || eventListeners.length === 0) {\n      debug(`ignoring '${eventName}' event with no listeners`)\n      return\n    }\n\n    for (const { host } of eventListeners) {\n      // TODO: may need to wake lazy extension context\n      if (host.isDestroyed()) {\n        console.error(`Unable to send '${eventName}' to extension host for ${extensionId}`)\n        continue\n      }\n\n      const ipcName = `crx-${eventName}`\n      host.send(ipcName, ...args)\n    }\n  }\n\n  /** Broadcasts extension event to all extension hosts listening for it. */\n  broadcastEvent(eventName: string, ...args: any[]) {\n    this.sendEvent(undefined, eventName, ...args)\n  }\n}\n","import { BrowserWindow, webContents } from 'electron'\nimport { EventEmitter } from 'events'\nimport { ContextMenuType } from './api/common'\nimport { ChromeExtensionImpl } from './impl'\nimport { ExtensionEvent } from './router'\n\nconst debug = require('debug')('electron-chrome-extensions:store')\n\nexport class ExtensionStore extends EventEmitter {\n  /** Tabs observed by the extensions system. */\n  tabs = new Set<Electron.WebContents>()\n\n  /** Windows observed by the extensions system. */\n  windows = new Set<Electron.BrowserWindow>()\n\n  lastFocusedWindowId?: number\n\n  /**\n   * Map of tabs to their parent window.\n   *\n   * It's not possible to access the parent of a BrowserView so we must manage\n   * this ourselves.\n   */\n  tabToWindow = new WeakMap<Electron.WebContents, Electron.BrowserWindow>()\n\n  /** Map of windows to their active tab. */\n  private windowToActiveTab = new WeakMap<Electron.BrowserWindow, Electron.WebContents>()\n\n  tabDetailsCache = new Map<number, Partial<chrome.tabs.Tab>>()\n  windowDetailsCache = new Map<number, Partial<chrome.windows.Window>>()\n\n  constructor(public impl: ChromeExtensionImpl) {\n    super()\n  }\n\n  getWindowById(windowId: number) {\n    return Array.from(this.windows).find(\n      (window) => !window.isDestroyed() && window.id === windowId\n    )\n  }\n\n  getLastFocusedWindow() {\n    return this.lastFocusedWindowId ? this.getWindowById(this.lastFocusedWindowId) : null\n  }\n\n  getCurrentWindow() {\n    return this.getLastFocusedWindow()\n  }\n\n  addWindow(window: Electron.BrowserWindow) {\n    if (this.windows.has(window)) return\n\n    this.windows.add(window)\n\n    if (typeof this.lastFocusedWindowId !== 'number') {\n      this.lastFocusedWindowId = window.id\n    }\n\n    this.emit('window-added', window)\n  }\n\n  async createWindow(event: ExtensionEvent, details: chrome.windows.CreateData) {\n    if (typeof this.impl.createWindow !== 'function') {\n      throw new Error('createWindow is not implemented')\n    }\n\n    const win = await this.impl.createWindow(details)\n\n    this.addWindow(win)\n\n    return win\n  }\n\n  async removeWindow(window: Electron.BrowserWindow) {\n    if (!this.windows.has(window)) return\n\n    this.windows.delete(window)\n\n    if (typeof this.impl.removeWindow === 'function') {\n      await this.impl.removeWindow(window)\n    } else {\n      window.destroy()\n    }\n  }\n\n  getTabById(tabId: number) {\n    return Array.from(this.tabs).find((tab) => !tab.isDestroyed() && tab.id === tabId)\n  }\n\n  addTab(tab: Electron.WebContents, window: Electron.BrowserWindow) {\n    if (this.tabs.has(tab)) return\n\n    this.tabs.add(tab)\n    this.tabToWindow.set(tab, window)\n    this.addWindow(window)\n\n    const activeTab = this.getActiveTabFromWebContents(tab)\n    if (!activeTab) {\n      this.setActiveTab(tab)\n    }\n\n    this.emit('tab-added', tab)\n  }\n\n  removeTab(tab: Electron.WebContents) {\n    if (!this.tabs.has(tab)) return\n\n    const tabId = tab.id\n    const win = this.tabToWindow.get(tab)!\n\n    this.tabs.delete(tab)\n    this.tabToWindow.delete(tab)\n\n    // TODO: clear active tab\n\n    // Clear window if it has no remaining tabs\n    const windowHasTabs = Array.from(this.tabs).find((tab) => this.tabToWindow.get(tab) === win)\n    if (!windowHasTabs) {\n      this.windows.delete(win)\n    }\n\n    if (typeof this.impl.removeTab === 'function') {\n      this.impl.removeTab(tab, win)\n    }\n\n    this.emit('tab-removed', tabId)\n  }\n\n  async createTab(details: chrome.tabs.CreateProperties) {\n    if (typeof this.impl.createTab !== 'function') {\n      throw new Error('createTab is not implemented')\n    }\n\n    // Fallback to current window\n    if (!details.windowId) {\n      details.windowId = this.lastFocusedWindowId\n    }\n\n    const result = await this.impl.createTab(details)\n\n    if (!Array.isArray(result)) {\n      throw new Error('createTab must return an array of [tab, window]')\n    }\n\n    const [tab, window] = result\n\n    if (typeof tab !== 'object' || !webContents.fromId(tab.id)) {\n      throw new Error('createTab must return a WebContents')\n    } else if (typeof window !== 'object') {\n      throw new Error('createTab must return a BrowserWindow')\n    }\n\n    this.addTab(tab, window)\n\n    return tab\n  }\n\n  getActiveTabFromWindow(win: Electron.BrowserWindow) {\n    const activeTab = win && !win.isDestroyed() && this.windowToActiveTab.get(win)\n    return (activeTab && !activeTab.isDestroyed() && activeTab) || undefined\n  }\n\n  getActiveTabFromWebContents(wc: Electron.WebContents): Electron.WebContents | undefined {\n    const win = this.tabToWindow.get(wc) || BrowserWindow.fromWebContents(wc)\n    return win ? this.getActiveTabFromWindow(win) : undefined\n  }\n\n  getActiveTabOfCurrentWindow() {\n    const win = this.getCurrentWindow()\n    return win ? this.getActiveTabFromWindow(win) : undefined\n  }\n\n  setActiveTab(tab: Electron.WebContents) {\n    const win = this.tabToWindow.get(tab)\n    if (!win) {\n      throw new Error('Active tab has no parent window')\n    }\n\n    const prevActiveTab = this.getActiveTabFromWebContents(tab)\n\n    this.windowToActiveTab.set(win, tab)\n\n    if (tab.id !== prevActiveTab?.id) {\n      this.emit('active-tab-changed', tab, win)\n\n      if (typeof this.impl.selectTab === 'function') {\n        this.impl.selectTab(tab, win)\n      }\n    }\n  }\n\n  buildMenuItems(extensionId: string, menuType: ContextMenuType): Electron.MenuItem[] {\n    // This function is overwritten by ContextMenusAPI\n    return []\n  }\n}\n","export * from './browser'\n","module.exports = require(\"electron\");","module.exports = require(\"events\");","module.exports = require(\"fs\");","module.exports = require(\"os\");","module.exports = require(\"path\");","module.exports = require(\"tty\");","module.exports = require(\"util\");"],"sourceRoot":""}